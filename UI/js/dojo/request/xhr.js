//>>built
define("dojo/request/xhr",["../errors/RequestError","./watch","./handlers","./util","../has"],function(e,r,a,t,i){function d(r,i){var d=r.xhr;r.status=r.xhr.status;try{r.text=d.responseText}catch(e){}"xml"===r.options.handleAs&&(r.data=d.responseXML);var l;if(i)this.reject(i);else{try{a(r)}catch(e){l=e}t.checkStatus(d.status)?l?this.reject(l):this.resolve(r):l?(i=new e("Unable to load "+r.url+" status: "+d.status+" and an error in handleAs: transformation of response",r),this.reject(i)):(i=new e("Unable to load "+r.url+" status: "+d.status,r),this.reject(i))}}function l(e){return this.xhr.getResponseHeader(e)}function o(a,y,w){var M=i("native-formdata")&&y&&y.data&&y.data instanceof FormData,c=t.parseArgs(a,t.deepCreate(h,y),M);a=c.url,y=c.options;var g=!y.data&&"POST"!==y.method&&"PUT"!==y.method;i("ie")<=10&&(a=a.split("#")[0]);var p,k=function(){p&&p()},b=t.deferred(c,m,n,s,d,k),F=c.xhr=o._create();if(!F)return b.cancel(new e("XHR was not created")),w?b:b.promise;c.getHeader=l,f&&(p=f(F,b,c));var I=void 0===y.data?null:y.data,z=!y.sync,A=y.method;try{F.open(A,a,z,y.user||u,y.password||u),y.withCredentials&&(F.withCredentials=y.withCredentials),i("native-response-type")&&y.handleAs in v&&(F.responseType=v[y.handleAs]);var q=y.headers,E=!M&&!g&&"application/x-www-form-urlencoded";if(q)for(var G in q)"content-type"===G.toLowerCase()?E=q[G]:q[G]&&F.setRequestHeader(G,q[G]);E&&!1!==E&&F.setRequestHeader("Content-Type",E),q&&"X-Requested-With"in q||F.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.notify&&t.notify.emit("send",c,b.promise.cancel),F.send(I)}catch(e){b.reject(e)}return r(b),F=null,w?b:b.promise}i.add("native-xhr",function(){return"undefined"!=typeof XMLHttpRequest}),i.add("dojo-force-activex-xhr",function(){return i("activex")&&"file:"===window.location.protocol}),i.add("native-xhr2",function(){if(i("native-xhr")&&!i("dojo-force-activex-xhr")){var e=new XMLHttpRequest;return void 0!==e.addEventListener&&("undefined"==typeof opera||void 0!==e.upload)}}),i.add("native-formdata",function(){return"undefined"!=typeof FormData}),i.add("native-blob",function(){return"undefined"!=typeof Blob}),i.add("native-arraybuffer",function(){return"undefined"!=typeof ArrayBuffer}),i.add("native-response-type",function(){return i("native-xhr")&&void 0!==(new XMLHttpRequest).responseType}),i.add("native-xhr2-blob",function(){if(i("native-response-type")){var e=new XMLHttpRequest;e.open("GET","https://dojotoolkit.org/",!0),e.responseType="blob";var r=e.responseType;return e.abort(),"blob"===r}});var n,s,f,m,v={blob:i("native-xhr2-blob")?"blob":"arraybuffer",document:"document",arraybuffer:"arraybuffer"};i("native-xhr2")?(n=function(e){return!this.isFulfilled()},m=function(e,r){r.xhr.abort()},f=function(r,a,t){function i(e){a.handleResponse(t)}function d(r){var i=r.target,d=new e("Unable to load "+t.url+" status: "+i.status,t);a.handleResponse(t,d)}function l(e){e.lengthComputable?(t.loaded=e.loaded,t.total=e.total,a.progress(t)):3===t.xhr.readyState&&(t.loaded="loaded"in e?e.loaded:e.position,a.progress(t))}return r.addEventListener("load",i,!1),r.addEventListener("error",d,!1),r.addEventListener("progress",l,!1),function(){r.removeEventListener("load",i,!1),r.removeEventListener("error",d,!1),r.removeEventListener("progress",l,!1),r=null}}):(n=function(e){return e.xhr.readyState},s=function(e){return 4===e.xhr.readyState},m=function(e,r){var a=r.xhr,t=typeof a.abort;"function"!==t&&"object"!==t&&"unknown"!==t||a.abort()});var u,h={data:null,query:null,sync:!1,method:"GET"};if(o._create=function(){throw new Error("XMLHTTP not available")},i("native-xhr")&&!i("dojo-force-activex-xhr"))o._create=function(){return new XMLHttpRequest};else if(i("activex"))try{new ActiveXObject("Msxml2.XMLHTTP"),o._create=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(e){try{new ActiveXObject("Microsoft.XMLHTTP"),o._create=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(e){}}return t.addCommonMethods(o),o});//# sourceMappingURL=xhr.js.map