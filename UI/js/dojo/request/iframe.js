//>>built
define("dojo/request/iframe",["module","require","./watch","./util","./handlers","../_base/lang","../io-query","../query","../has","../dom","../dom-construct","../_base/window","../NodeList-dom","../NodeList-manipulate"],function(e,r,a,t,i,d,l,o,n,s,f,m){function v(e,a,t){if(m.global[e])return m.global[e];if(m.global.frames[e])return m.global.frames[e];t||(n("config-useXDomain")&&n("config-dojoBlankHtmlUrl"),t=n("config-dojoBlankHtmlUrl")||r.toUrl("dojo/resources/blank.html"));var i=f.place('<iframe id="'+e+'" name="'+e+'" src="'+t+'" onload="'+a+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',m.body());return m.global[e]=i,i}function u(e,r,a){var t=m.global.frames[e.name];t.contentWindow&&(t=t.contentWindow);try{a?t.location.replace(r):t.location=r}catch(e){}}function h(e){if(e.contentDocument)return e.contentDocument;var r=e.name;if(r){var a=m.doc.getElementsByTagName("iframe");if(e.document&&a[r].contentWindow&&a[r].contentWindow.document)return a[r].contentWindow.document;if(m.doc.frames[r]&&m.doc.frames[r].document)return m.doc.frames[r].document}return null}function y(){return f.create("form",{name:b+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},m.body())}function w(){var e;try{if(k._currentDfd||!k._dfdQueue.length)return;do{e=k._currentDfd=k._dfdQueue.shift()}while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&k._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled())return void(k._currentDfd=null);var r,a=e.response,i=a.options,n=e._contentToClean=[],v=s.byId(i.form),u=t.notify,h=i.data||null;if(e._legacy||"POST"!==i.method||v?"GET"===i.method&&v&&a.url.indexOf("?")>-1&&(r=a.url.slice(a.url.indexOf("?")+1),h=d.mixin(l.queryToObject(r),h)):v=e._tmpForm=y(),v){if(!e._legacy){var w=v;do{w=w.parentNode}while(w&&w!==m.doc.documentElement);w||(v.style.position="absolute",v.style.left="-1000px",v.style.top="-1000px",m.body().appendChild(v)),v.name||(v.name=b+"_form")}if(h){var M=function(e,r){f.create("input",{type:"hidden",name:e,value:r},v),n.push(e)};for(var c in h){var g=h[c];if(d.isArray(g)&&g.length>1)for(var p=0;p<g.length;p++)M(c,g[p]);else{var F=o("input[name='"+c+"']",v);-1==F.indexOf()?M(c,g):F.val(g)}}}var I=v.getAttributeNode("action"),z=v.getAttributeNode("method"),A=v.getAttributeNode("target");a.url&&(e._originalAction=I?I.value:null,I?I.value=a.url:v.setAttribute("action",a.url)),e._legacy?z&&z.value||(z?z.value=i.method:v.setAttribute("method",i.method)):(e._originalMethod=z?z.value:null,z?z.value=i.method:v.setAttribute("method",i.method)),e._originalTarget=A?A.value:null,A?A.value=k._iframeName:v.setAttribute("target",k._iframeName),v.target=k._iframeName,u&&u.emit("send",a,e.promise.cancel),k._notifyStart(a),v.submit()}else{var q="";a.options.data&&"string"!=typeof(q=a.options.data)&&(q=l.objectToQuery(q));var E=a.url+(a.url.indexOf("?")>-1?"&":"?")+q;u&&u.emit("send",a,e.promise.cancel),k._notifyStart(a),k.setSrc(k._frame,E,!0)}}catch(r){e.reject(r)}}function M(e){return!this.isFulfilled()}function c(e){return!!this._finished}function g(e,r){if(!r)try{var a=e.options,t=k.doc(k._frame),l=a.handleAs;if("html"!==l){if("xml"===l)if("html"===t.documentElement.tagName.toLowerCase()){o("a",t.documentElement).orphan();var n=t.documentElement.innerText||t.documentElement.textContent;n=n.replace(/>\s+</g,"><"),e.text=d.trim(n)}else e.data=t;else e.text=t.getElementsByTagName("textarea")[0].value;i(e)}else e.data=t}catch(e){r=e}r?this.reject(r):this._finished?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function p(e){this._callNext()}function k(e,r,i){var d=t.parseArgs(e,t.deepCreate(I,r),!0);if(e=d.url,r=d.options,"GET"!==r.method&&"POST"!==r.method)throw new Error(r.method+" not supported by dojo/request/iframe");k._frame||(k._frame=k.create(k._iframeName,F+"();"));var l=t.deferred(d,null,M,c,g,p);return l._callNext=function(){this._calledNext||(this._calledNext=!0,k._currentDfd=null,k._fireNextRequest())},l._legacy=i,k._dfdQueue.push(l),k._fireNextRequest(),a(l),i?l:l.promise}var b=e.id.replace(/[\/\.\-]/g,"_"),F=b+"_onload";m.global[F]||(m.global[F]=function(){var e=k._currentDfd;if(!e)return void k._fireNextRequest();var r=e.response,a=r.options,t=s.byId(a.form)||e._tmpForm;if(t){for(var i=e._contentToClean,d=0;d<i.length;d++)for(var l=i[d],o=0;o<t.childNodes.length;o++){var n=t.childNodes[o];if(n.name===l){f.destroy(n);break}}e._originalAction&&t.setAttribute("action",e._originalAction),e._originalMethod&&(t.setAttribute("method",e._originalMethod),t.method=e._originalMethod),e._originalTarget&&(t.setAttribute("target",e._originalTarget),t.target=e._originalTarget)}e._tmpForm&&(f.destroy(e._tmpForm),delete e._tmpForm),e._finished=!0});var I={method:"POST"};return k.create=v,k.doc=h,k.setSrc=u,k._iframeName=b+"_IoIframe",k._notifyStart=function(){},k._dfdQueue=[],k._currentDfd=null,k._fireNextRequest=w,t.addCommonMethods(k,["GET","POST"]),k});//# sourceMappingURL=iframe.js.map