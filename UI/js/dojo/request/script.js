//>>built
define("dojo/request/script",["module","./watch","./util","../_base/kernel","../_base/array","../_base/lang","../on","../dom","../dom-construct","../has","../_base/window"],function(module,watch,util,kernel,array,lang,on,dom,domConstruct,has,win){function attach(e,r,a,t){var i=a||win.doc,d=i.createElement("script");t&&on.once(d,"error",t),d.type="text/javascript";try{d.src=r}catch(e){t&&t(d)}return d.id=e,d.async=!0,d.charset="utf-8",i.getElementsByTagName("head")[0].appendChild(d)}function remove(e,r,a){domConstruct.destroy(dom.byId(e,r)),callbacks[e]&&(a?callbacks[e]=function(){delete callbacks[e]}:delete callbacks[e])}function _addDeadScript(e){var r=e.response.options,a=r.ioArgs?r.ioArgs.frameDoc:r.frameDoc;deadScripts.push({id:e.id,frameDoc:a}),r.ioArgs&&(r.ioArgs.frameDoc=null),r.frameDoc=null}function canceler(e,r){e.canDelete&&script._remove(e.id,r.options.frameDoc,!0)}function isValid(e){return deadScripts&&deadScripts.length&&(array.forEach(deadScripts,function(e){script._remove(e.id,e.frameDoc),e.frameDoc=null}),deadScripts=[]),!e.options.jsonp||!e.data}function isReadyScript(e){return!!this.scriptLoaded}function isReadyCheckString(response){var checkString=response.options.checkString;return checkString&&eval("typeof("+checkString+') !== "undefined"')}function handleResponse(e,r){this.canDelete&&_addDeadScript(this),r?this.reject(r):this.resolve(e)}function script(e,r,a){var t=util.parseArgs(e,util.deepCopy({},r));e=t.url,r=t.options;var i=util.deferred(t,canceler,isValid,r.jsonp?null:r.checkString?isReadyCheckString:isReadyScript,handleResponse);if(lang.mixin(i,{id:mid+counter++,canDelete:!1}),r.jsonp){new RegExp("[?&]"+r.jsonp+"=").test(e)||(e+=(~e.indexOf("?")?"&":"?")+r.jsonp+"="+(r.frameDoc?"parent.":"")+mid+"_callbacks."+i.id),i.canDelete=!0,callbacks[i.id]=function(e){t.data=e,i.handleResponse(t)}}if(util.notify&&util.notify.emit("send",t,i.promise.cancel),!r.canAttach||r.canAttach(i)){var d=script._attach(i.id,e,r.frameDoc,function(e){if(!(e instanceof Error)){var a=new Error("Error loading "+(e.target?e.target.src:"script"));a.source=e,e=a}i.reject(e),script._remove(i.id,r.frameDoc,!0)});if(!r.jsonp&&!r.checkString)var l=on(d,loadEvent,function(e){("load"===e.type||readyRegExp.test(d.readyState))&&(l.remove(),i.scriptLoaded=e)})}return watch(i),a?i:i.promise}has.add("script-readystatechange",function(e,r){return void 0!==r.createElement("script").onreadystatechange&&(void 0===e.opera||"[object Opera]"!==e.opera.toString())});var mid=module.id.replace(/[\/\.\-]/g,"_"),counter=0,loadEvent=has("script-readystatechange")?"readystatechange":"load",readyRegExp=/complete|loaded/,callbacks=kernel.global[mid+"_callbacks"]={},deadScripts=[];return script.get=script,script._attach=attach,script._remove=remove,script._callbacksProperty=mid+"_callbacks",script});//# sourceMappingURL=script.js.map