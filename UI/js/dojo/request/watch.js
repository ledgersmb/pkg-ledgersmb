//>>built
define("dojo/request/watch",["./util","../errors/RequestTimeoutError","../errors/CancelError","../_base/array","../_base/window","../has!host-browser?dom-addeventlistener?:../on:"],function(e,r,a,t,i,d){function l(){for(var e,a=+new Date,t=0;t<s.length&&(e=s[t]);t++){var i=e.response,d=i.options;e.isCanceled&&e.isCanceled()||e.isValid&&!e.isValid(i)?(s.splice(t--,1),o._onAction&&o._onAction()):e.isReady&&e.isReady(i)?(s.splice(t--,1),e.handleResponse(i),o._onAction&&o._onAction()):e.startTime&&e.startTime+(d.timeout||0)<a&&(s.splice(t--,1),e.cancel(new r("Timeout exceeded",i)),o._onAction&&o._onAction())}o._onInFlight&&o._onInFlight(e),s.length||(clearInterval(n),n=null)}function o(e){e.response.options.timeout&&(e.startTime=+new Date),e.isFulfilled()||(s.push(e),n||(n=setInterval(l,50)),e.response.options.sync&&l())}var n=null,s=[];return o.cancelAll=function(){try{t.forEach(s,function(e){try{e.cancel(new a("All requests canceled."))}catch(e){}})}catch(e){}},i&&d&&i.doc.attachEvent&&d(i.global,"unload",function(){o.cancelAll()}),o});//# sourceMappingURL=watch.js.map