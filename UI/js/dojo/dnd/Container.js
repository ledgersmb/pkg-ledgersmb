//>>built
define("dojo/dnd/Container",["../_base/array","../_base/declare","../_base/kernel","../_base/lang","../_base/window","../dom","../dom-class","../dom-construct","../Evented","../has","../on","../query","../touch","./common"],function(e,r,a,t,i,d,l,o,n,s,f,m,v,u){var h=r("dojo.dnd.Container",n,{skipForm:!1,allowNested:!1,constructor:function(e,r){this.node=d.byId(e),r||(r={}),this.creator=r.creator||null,this.skipForm=r.skipForm,this.parent=r.dropParent&&d.byId(r.dropParent),this.map={},this.current=null,this.containerState="",l.add(this.node,"dojoDndContainer"),r&&r._skipStartup||this.startup(),this.events=[f(this.node,v.over,t.hitch(this,"onMouseOver")),f(this.node,v.out,t.hitch(this,"onMouseOut")),f(this.node,"dragstart",t.hitch(this,"onSelectStart")),f(this.node,"selectstart",t.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(e){return this.map[e]},setItem:function(e,r){this.map[e]=r},delItem:function(e){delete this.map[e]},forInItems:function(e,r){r=r||a.global;var t=this.map,i=u._empty;for(var d in t)d in i||e.call(r,t[d],d,this);return r},clearItems:function(){this.map={}},getAllNodes:function(){return m((this.allowNested?"":"> ")+".dojoDndItem",this.parent)},sync:function(){var e={};return this.getAllNodes().forEach(function(r){if(r.id){var a=this.getItem(r.id);if(a)return void(e[r.id]=a)}else r.id=u.getUniqueId();var t=r.getAttribute("dndType"),i=r.getAttribute("dndData");e[r.id]={data:i||r.innerHTML,type:t?t.split(/\s*,\s*/):["text"]}},this),this.map=e,this},insertNodes:function(e,r,a){this.parent.firstChild?r?a||(a=this.parent.firstChild):a&&(a=a.nextSibling):a=null;var t,i;if(a)for(t=0;t<e.length;++t)i=this._normalizedCreator(e[t]),this.setItem(i.node.id,{data:i.data,type:i.type}),a.parentNode.insertBefore(i.node,a);else for(t=0;t<e.length;++t)i=this._normalizedCreator(e[t]),this.setItem(i.node.id,{data:i.data,type:i.type}),this.parent.appendChild(i.node);return this},destroy:function(){e.forEach(this.events,function(e){e.remove()}),this.clearItems(),this.node=this.parent=this.current=null},markupFactory:function(e,r,a){return e._skipStartup=!0,new a(r,e)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var e=this.parent.getElementsByTagName("tbody");e&&e.length&&(this.parent=e[0])}this.defaultCreator=u._defaultCreator(this.parent),this.sync()},onMouseOver:function(e){for(var r=e.relatedTarget;r&&r!=this.node;)try{r=r.parentNode}catch(e){r=null}r||(this._changeState("Container","Over"),this.onOverEvent()),r=this._getChildByEvent(e),this.current!=r&&(this.current&&this._removeItemClass(this.current,"Over"),r&&this._addItemClass(r,"Over"),this.current=r)},onMouseOut:function(e){for(var r=e.relatedTarget;r;){if(r==this.node)return;try{r=r.parentNode}catch(e){r=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null),this._changeState("Container",""),this.onOutEvent()},onSelectStart:function(e){this.withHandles||this.skipForm&&u.isFormElement(e)||(e.stopPropagation(),e.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(e,r){var a="dojoDnd"+e,t=e.toLowerCase()+"State";l.replace(this.node,a+r,a+this[t]),this[t]=r},_addItemClass:function(e,r){l.add(e,"dojoDndItem"+r)},_removeItemClass:function(e,r){l.remove(e,"dojoDndItem"+r)},_getChildByEvent:function(e){var r=e.target;if(r)for(var a=r.parentNode;a;r=a,a=r.parentNode)if((a==this.parent||this.allowNested)&&l.contains(r,"dojoDndItem"))return r;return null},_normalizedCreator:function(e,r){var a=(this.creator||this.defaultCreator).call(this,e,r);return t.isArray(a.type)||(a.type=["text"]),a.node.id||(a.node.id=u.getUniqueId()),l.add(a.node,"dojoDndItem"),a}});return u._createNode=function(e){return e?function(r){return o.create(e,{innerHTML:r})}:u._createSpan},u._createTrTd=function(e){var r=o.create("tr");return o.create("td",{innerHTML:e},r),r},u._createSpan=function(e){return o.create("span",{innerHTML:e})},u._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"},u._defaultCreator=function(e){var r=e.tagName.toLowerCase(),a="tbody"==r||"thead"==r?u._createTrTd:u._createNode(u._defaultCreatorNodes[r]);return function(e,r){var i,d,l,o=e&&t.isObject(e);return o&&e.tagName&&e.nodeType&&e.getAttribute?(i=e.getAttribute("dndData")||e.innerHTML,d=e.getAttribute("dndType"),d=d?d.split(/\s*,\s*/):["text"],l=e):(i=o&&e.data?e.data:e,d=o&&e.type?e.type:["text"],l=("avatar"==r?u._createSpan:a)(String(i))),l.id||(l.id=u.getUniqueId()),{node:l,data:i,type:d}}},h});//# sourceMappingURL=Container.js.map