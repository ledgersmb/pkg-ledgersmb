//>>built
define("dojo/router/RouterBase",["dojo/_base/declare","dojo/hash","dojo/topic"],function(e,r,a){function t(e,r,a){var t,i,d,l,o,n,s;if(t=this.callbackQueue,i=!1,d=!1,l={stopImmediatePropagation:function(){i=!0},preventDefault:function(){d=!0},oldPath:r,newPath:a,params:e},o=[l],e instanceof Array)o=o.concat(e);else for(var f in e)o.push(e[f]);for(n=0,s=t.length;n<s;++n)i||t[n].apply(null,o);return!d}var i;return i=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},e(null,{_routes:null,_routeIndex:null,_started:!1,_currentPath:"",idMatch:/:(\w[\w\d]*)/g,idReplacement:"([^\\/]+)",globMatch:/\*(\w[\w\d]*)/,globReplacement:"(.+)",constructor:function(e){this._routes=[],this._routeIndex={};for(var r in e)e.hasOwnProperty(r)&&(this[r]=e[r])},register:function(e,r){return this._registerRoute(e,r)},registerBefore:function(e,r){return this._registerRoute(e,r,!0)},go:function(e,a){var t;return"string"==typeof e&&(e=i(e),t=this._handlePathChange(e),t&&r(e,a),t)},startup:function(e){if(!this._started){var t=this,i=r();this._started=!0,this._hashchangeHandle=a.subscribe("/dojo/hashchange",function(){t._handlePathChange.apply(t,arguments)}),i?this._handlePathChange(i):this.go(e,!0)}},destroy:function(){this._hashchangeHandle&&this._hashchangeHandle.remove(),this._routes=null,this._routeIndex=null},_handlePathChange:function(e){var r,a,t,i,d,l,o,n,s,f=this._routes,m=this._currentPath;if(!this._started||e===m)return o;for(o=!0,r=0,t=f.length;r<t;++r)if(d=f[r],l=d.route.exec(e)){if(d.parameterNames)for(n=d.parameterNames,s={},a=0,i=n.length;a<i;++a)s[n[a]]=l[a+1];else s=l.slice(1);o=d.fire(s,m,e)}return o&&(this._currentPath=e),o},_convertRouteToRegExp:function(e){return e=e.replace(this.idMatch,this.idReplacement),e=e.replace(this.globMatch,this.globReplacement),e="^"+e+"$",new RegExp(e)},_getParameterNames:function(e){var r,a=this.idMatch,t=this.globMatch,i=[];for(a.lastIndex=0;null!==(r=a.exec(e));)i.push(r[1]);return null!==(r=t.exec(e))&&i.push(r[1]),i.length>0?i:null},_indexRoutes:function(){var e,r,a,t,i=this._routes;for(t=this._routeIndex={},e=0,r=i.length;e<r;++e)a=i[e],t[a.route]=e},_registerRoute:function(e,r,a){var i,d,l,o,n,s=this,f=this._routes,m=this._routeIndex;return i=this._routeIndex[e],d=void 0!==i,d&&(l=f[i]),l||(l={route:e,callbackQueue:[],fire:t}),o=l.callbackQueue,"string"==typeof e&&(l.parameterNames=this._getParameterNames(e),l.route=this._convertRouteToRegExp(e)),a?o.unshift(r):o.push(r),d||(i=f.length,m[e]=i,f.push(l)),n=!1,{remove:function(){var e,a;if(!n){for(e=0,a=o.length;e<a;++e)o[e]===r&&o.splice(e,1);0===o.length&&(f.splice(i,1),s._indexRoutes()),n=!0}},register:function(r,a){return s.register(e,r,a)}}}})});//# sourceMappingURL=RouterBase.js.map