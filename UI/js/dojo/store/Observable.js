//>>built
define("dojo/store/Observable",["../_base/kernel","../_base/lang","../when","../_base/array"],function(e,r,a,t){var i=function(e){function i(r,t){var i=e[r];i&&(e[r]=function(d){var l;if("put"===r&&(l=e.getIdentity(d)),s)return i.apply(this,arguments);s=!0;try{var o=i.apply(this,arguments);return a(o,function(e){t("object"==typeof e&&e||d,l)}),o}finally{s=!1}})}var d,l=[],o=0;e=r.delegate(e),e.notify=function(e,r){o++;for(var a=l.slice(),t=0,i=a.length;t<i;t++)a[t](e,r)};var n=e.query;e.query=function(i,s){s=s||{};var f=n.apply(this,arguments);if(f&&f.forEach){var m=r.mixin({},s);delete m.start,delete m.count;var v,u=e.queryEngine&&e.queryEngine(i,m),h=o,y=[];f.observe=function(r,i){1==y.push(r)&&l.push(v=function(r,l){a(f,function(a){var n,f,m,v=a.length!=s.count;if(++h!=o)throw new Error("Query is out of date, you must observe() the query prior to any data modifications");var w,M=-1,c=-1;if(l!==d){var g=[].concat(a);for(u&&!r&&(g=u(a)),n=0,f=a.length;n<f;n++){var p=a[n];if(e.getIdentity(p)==l){if(g.indexOf(p)<0)continue;w=p,M=n,!u&&r||a.splice(n,1);break}}}if(u){if(r&&(u.matches?u.matches(r):u([r]).length)){var k=M>-1?M:a.length;a.splice(k,0,r),c=t.indexOf(u(a),r),a.splice(k,1),s.start&&0==c||!v&&c==a.length?c=-1:a.splice(c,0,r)}}else r&&(l!==d?c=M:s.start||(c=e.defaultIndex||0,a.splice(c,0,r)));if((M>-1||c>-1)&&(i||!u||M!=c)){var b=y.slice();for(n=0;m=b[n];n++)m(r||w,M,c)}})});var n={};return n.remove=n.cancel=function(){var e=t.indexOf(y,r);e>-1&&(y.splice(e,1),y.length||l.splice(t.indexOf(l,v),1))},n}}return f};var s;return i("put",function(r,a){e.notify(r,a)}),i("add",function(r){e.notify(r)}),i("remove",function(r){e.notify(void 0,r)}),e};return r.setObject("dojo.store.Observable",i),i});//# sourceMappingURL=Observable.js.map