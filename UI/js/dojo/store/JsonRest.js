//>>built
define("dojo/store/JsonRest",["../_base/xhr","../_base/lang","../json","../_base/declare","./util/QueryResults"],function(e,r,a,t,i){return t("dojo.store.JsonRest",null,{constructor:function(e){this.headers={},t.safeMixin(this,e)},headers:{},target:"",idProperty:"id",ascendingPrefix:"+",descendingPrefix:"-",_getTarget:function(e){var r=this.target;return void 0!==e&&("/"==r.charAt(r.length-1)||"="==r.charAt(r.length-1)?r+=e:r+="/"+e),r},get:function(a,t){t=t||{};var i=r.mixin({Accept:this.accepts},this.headers,t.headers||t);return e("GET",{url:this._getTarget(a),handleAs:"json",headers:i,timeout:t&&t.timeout})},accepts:"application/javascript, application/json",getIdentity:function(e){return e[this.idProperty]},put:function(t,i){i=i||{};var d="id"in i?i.id:this.getIdentity(t);return e(void 0===d||i.incremental?"POST":"PUT",{url:this._getTarget(d),postData:a.stringify(t),handleAs:"json",headers:r.mixin({"Content-Type":"application/json",Accept:this.accepts,"If-Match":!0===i.overwrite?"*":null,"If-None-Match":!1===i.overwrite?"*":null},this.headers,i.headers),timeout:i&&i.timeout})},add:function(e,r){return r=r||{},r.overwrite=!1,this.put(e,r)},remove:function(a,t){return t=t||{},e("DELETE",{url:this._getTarget(a),headers:r.mixin({},this.headers,t.headers),timeout:t&&t.timeout})},query:function(a,t){t=t||{};var d=r.mixin({Accept:this.accepts},this.headers,t.headers),l=this.target.indexOf("?")>-1;if(a=a||"",a&&"object"==typeof a&&(a=e.objectToQuery(a),a=a?(l?"&":"?")+a:""),(t.start>=0||t.count>=0)&&(d["X-Range"]="items="+(t.start||"0")+"-"+("count"in t&&t.count!=1/0?t.count+(t.start||0)-1:""),this.rangeParam?(a+=(a||l?"&":"?")+this.rangeParam+"="+d["X-Range"],l=!0):d.Range=d["X-Range"]),t&&t.sort){var o=this.sortParam;a+=(a||l?"&":"?")+(o?o+"=":"sort(");for(var n=0;n<t.sort.length;n++){var s=t.sort[n];a+=(n>0?",":"")+(s.descending?this.descendingPrefix:this.ascendingPrefix)+encodeURIComponent(s.attribute)}o||(a+=")")}var f=e("GET",{url:this.target+(a||""),handleAs:"json",headers:d,timeout:t&&t.timeout});return f.total=f.then(function(){var e=f.ioArgs.xhr.getResponseHeader("Content-Range");return e||(e=f.ioArgs.xhr.getResponseHeader("X-Content-Range")),e&&(e=e.match(/\/(.*)/))&&+e[1]}),i(f)}})});//# sourceMappingURL=JsonRest.js.map