//>>built
define("dojo/promise/instrumentation",["./tracer","../has","../_base/lang","../_base/array"],function(e,r,a,t){function i(e,r,a){if(!e||!1!==e.log){var t="";e&&e.stack&&(t+=e.stack),r&&r.stack&&(t+="\n    ----------------------------------------\n    rejected"+r.stack.split("\n").slice(1).join("\n").replace(/^\s+/," ")),a&&a.stack&&(t+="\n    ----------------------------------------\n"+a.stack),console.error(e,t)}}function d(e,r,a,t){r||i(e,a,t)}function l(e,r,a,i){t.some(n,function(a){if(a.error===e)return r&&(a.handled=!0),!0})||n.push({error:e,rejection:a,handled:r,deferred:i,timestamp:(new Date).getTime()}),s||(s=setTimeout(o,f))}function o(){var e=(new Date).getTime(),r=e-f;n=t.filter(n,function(e){return!(e.timestamp<r)||(e.handled||i(e.error,e.rejection,e.deferred),!1)}),s=!!n.length&&setTimeout(o,n[0].timestamp+f-e)}r.add("config-useDeferredInstrumentation","report-unhandled-rejections");var n=[],s=!1,f=1e3;return function(t){var i=r("config-useDeferredInstrumentation");if(i){e.on("resolved",a.hitch(console,"log","resolved")),e.on("rejected",a.hitch(console,"log","rejected")),e.on("progress",a.hitch(console,"log","progress"));var o=[];if("string"==typeof i&&(o=i.split(","),i=o.shift()),"report-rejections"===i)t.instrumentRejected=d;else{if("report-unhandled-rejections"!==i&&!0!==i&&1!==i)throw new Error("Unsupported instrumentation usage <"+i+">");t.instrumentRejected=l,f=parseInt(o[0],10)||f}}}});//# sourceMappingURL=instrumentation.js.map