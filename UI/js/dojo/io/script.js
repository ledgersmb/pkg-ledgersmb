//>>built
define("dojo/io/script",["../_base/connect","../_base/kernel","../_base/lang","../sniff","../_base/window","../_base/xhr","../dom","../dom-construct","../request/script","../aspect"],function(connect,kernel,lang,has,win,xhr,dom,domConstruct,_script,aspect){kernel.deprecated("dojo/io/script","Use dojo/request/script.","2.0");var script={get:function(e){var r,a=this._makeScriptDeferred(e,function(e){r&&r.cancel()}),t=a.ioArgs;return xhr._ioAddQueryToUrl(t),xhr._ioNotifyStart(a),r=_script.get(t.url,{timeout:e.timeout,jsonp:t.jsonp,checkString:e.checkString,ioArgs:t,frameDoc:e.frameDoc,canAttach:function(e){return t.requestId=e.id,t.scriptId=e.scriptId,t.canDelete=e.canDelete,script._canAttach(t)}},!0),aspect.around(r,"isValid",function(e){return function(r){return script._validCheck(a),e.call(this,r)}}),r.then(function(){a.resolve(a)}).otherwise(function(e){a.ioArgs.error=e,a.reject(e)}),a},attach:_script._attach,remove:_script._remove,_makeScriptDeferred:function(e,r){var a=xhr._ioSetArgs(e,r||this._deferredCancel,this._deferredOk,this._deferredError),t=a.ioArgs;return t.id=kernel._scopeName+"IoScript"+this._counter++,t.canDelete=!1,t.jsonp=e.callbackParamName||e.jsonp,t.jsonp&&(t.query=t.query||"",t.query.length>0&&(t.query+="&"),t.query+=t.jsonp+"="+(e.frameDoc?"parent.":"")+kernel._scopeName+".io.script.jsonp_"+t.id+"._jsonpCallback",t.frameDoc=e.frameDoc,t.canDelete=!0,a._jsonpCallback=this._jsonpCallback,this["jsonp_"+t.id]=a),a.addBoth(function(e){t.canDelete&&(e instanceof Error?script["jsonp_"+t.id]._jsonpCallback=function(){delete script["jsonp_"+t.id],t.requestId&&kernel.global[_script._callbacksProperty][t.requestId]()}:script._addDeadScript(t))}),a},_deferredCancel:function(e){e.canceled=!0},_deferredOk:function(e){var r=e.ioArgs;return r.json||r.scriptLoaded||r},_deferredError:function(e,r){return e},_deadScripts:[],_counter:1,_addDeadScript:function(e){script._deadScripts.push({id:e.id,frameDoc:e.frameDoc}),e.frameDoc=null},_validCheck:function(e){var r=script._deadScripts;if(r&&r.length>0){for(var a=0;a<r.length;a++)script.remove(r[a].id,r[a].frameDoc),delete script["jsonp_"+r[a].id],r[a].frameDoc=null;script._deadScripts=[]}return!0},_ioCheck:function(dfd){var ioArgs=dfd.ioArgs;if(ioArgs.json||ioArgs.scriptLoaded&&!ioArgs.args.checkString)return!0;var checkString=ioArgs.args.checkString;return checkString&&eval("typeof("+checkString+") != 'undefined'")},_resHandle:function(e){script._ioCheck(e)?e.callback(e):e.errback(new Error("inconceivable dojo.io.script._resHandle error"))},_canAttach:function(){return!0},_jsonpCallback:function(e){this.ioArgs.json=e,this.ioArgs.requestId&&kernel.global[_script._callbacksProperty][this.ioArgs.requestId](e)}};return lang.setObject("dojo.io.script",script),script});//# sourceMappingURL=script.js.map