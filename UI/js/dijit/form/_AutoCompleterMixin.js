//>>built
define("dijit/form/_AutoCompleterMixin",["dojo/aspect","dojo/_base/declare","dojo/dom-attr","dojo/keys","dojo/_base/lang","dojo/query","dojo/regexp","dojo/sniff","./DataList","./_TextBoxMixin","./_SearchMixin"],function(e,t,r,a,i,d,l,o,n,s,f){var m=t("dijit.form._AutoCompleterMixin",f,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(e){var t=0;if("number"==typeof e.selectionStart)t=e.selectionStart;else if(o("ie")){var r=e.ownerDocument.selection.createRange().duplicate(),a=e.createTextRange();r.move("character",0),a.move("character",0);try{a.setEndPoint("EndToEnd",r),t=String(a.text).replace(/\r/g,"").length}catch(e){}}return t},_setCaretPos:function(e,t){t=parseInt(t),s.selectInputText(e,t,t)},_setDisabledAttr:function(e){this.inherited(arguments),this.domNode.setAttribute("aria-disabled",e?"true":"false")},_onKey:function(e){if(!(e.charCode>=32)){var t=e.charCode||e.keyCode;if(t!=a.ALT&&t!=a.CTRL&&t!=a.META&&t!=a.SHIFT){var r=this.dropDown,i=null;if(this._abortQuery(),this.inherited(arguments),!(e.altKey||e.ctrlKey||e.metaKey))switch(this._opened&&(i=r.getHighlightedOption()),t){case a.PAGE_DOWN:case a.DOWN_ARROW:case a.PAGE_UP:case a.UP_ARROW:this._opened&&this._announceOption(i),e.stopPropagation(),e.preventDefault();break;case a.ENTER:if(i){if(i==r.nextButton){this._nextSearch(1),e.stopPropagation(),e.preventDefault();break}if(i==r.previousButton){this._nextSearch(-1),e.stopPropagation(),e.preventDefault();break}e.stopPropagation(),e.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case a.TAB:var d=this.get("displayedValue");if(r&&(d==r._messages.previousMessage||d==r._messages.nextMessage))break;i&&this._selectOption(i);case a.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(e){var t=this.focusNode;s.selectInputText(t,t.value.length);var r=this.ignoreCase?"toLowerCase":"substr";if(0==e[r](0).indexOf(this.focusNode.value[r](0))){var a=this.autoComplete?this._getCaretPos(t):t.value.length;a+1>t.value.length&&(t.value=e,s.selectInputText(t,a))}else t.value=e,s.selectInputText(t)},_openResultList:function(e,t,r){var a=this.dropDown.getHighlightedOption();if(this.dropDown.clearResultList(),!e.length&&0==r.start)return void this.closeDropDown();this._nextSearch=this.dropDown.onPage=i.hitch(this,function(t){e.nextPage(-1!==t),this.focus()}),this.dropDown.createOptions(e,r,i.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in r?(r.direction?this.dropDown.highlightFirstOption():r.direction||this.dropDown.highlightLastOption(),a&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(t[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)},_showResultList:function(){this.closeDropDown(!0),this.openDropDown(),this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery(),this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var e=this.get("displayedValue"),t=this.dropDown;!t||e!=t._messages.previousMessage&&e!=t._messages.nextMessage?void 0===this.item?(this.item=null,this.set("displayedValue",e)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0),this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(e,t,r){var a="";e&&(r||(r=this.store._oldAPI?this.store.getValue(e,this.searchAttr):e[this.searchAttr]),a=this._getValueField()!=this.searchAttr?this.store.getIdentity(e):r),this.set("value",a,t,r,e)},_announceOption:function(e){if(e){var t;if(e==this.dropDown.nextButton||e==this.dropDown.previousButton)t=e.innerHTML,this.item=void 0,this.value="";else{var a=this.dropDown.items[e.getAttribute("item")];t=(this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]).toString(),this.set("item",a,!1,t)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length),this.focusNode.setAttribute("aria-activedescendant",r.get(e,"id")),this._autoCompleteText(t)}},_selectOption:function(e){this.closeDropDown(),e&&this._announceOption(e),this._setCaretPos(this.focusNode,this.focusNode.value.length),this._handleOnChange(this.value,!0),this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0,this.inherited(arguments)},_startSearch:function(e){if(!this.dropDown){var t=this.id+"_popup",r=i.isString(this.dropDownClass)?i.getObject(this.dropDownClass,!1):this.dropDownClass;this.dropDown=new r({onChange:i.hitch(this,this._selectOption),id:t,dir:this.dir,textDir:this.textDir})}this._lastInput=e,this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){if(this.inherited(arguments),!this.store&&this.srcNodeRef){var e=this.srcNodeRef;if(this.store=new n({},e),!("value"in this.params)){var t=this.item=this.store.fetchSelectedItem();if(t){var r=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(t,r):t[r]}}}},postCreate:function(){var t=d('label[for="'+this.id+'"]');t.length&&(t[0].id||(t[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",t[0].id)),this.inherited(arguments),e.after(this,"onSearch",i.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(e){var t=this.labelFunc(e,this.store),r=this.labelType;return"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(t=this.doHighlight(t,this._lastInput),r="html"),{html:"html"==r,label:t}},doHighlight:function(e,t){var r=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),a=this.queryExpr.indexOf("${0}");return t=l.escapeString(t),this._escapeHtml(e.replace(new RegExp((0==a?"^":"")+"("+t+")"+(a==this.queryExpr.length-4?"$":""),r),"￿$1￿")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'<span class="dijitComboBoxHighlightMatch">$1</span>')},_escapeHtml:function(e){return e=String(e).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")},reset:function(){this.item=null,this.inherited(arguments)},labelFunc:function(e,t){return(t._oldAPI?t.getValue(e,this.labelAttr||this.searchAttr):e[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(e,t,r,a){this._set("item",a||null),null==e&&(e=""),this.inherited(arguments)}});return o("dojo-bidi")&&m.extend({_setTextDirAttr:function(e){this.inherited(arguments),this.dropDown&&this.dropDown._set("textDir",e)}}),m});//# sourceMappingURL=_AutoCompleterMixin.js.map