//>>built
define("dijit/_editor/range",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(e,t,r){var a={getIndex:function(e,t){for(var r,a,i=[],d=[],l=e;e!=t;){var o=0;for(r=e.parentNode;a=r.childNodes[o++];)if(a===e){--o;break}i.unshift(o),d.unshift(o-r.childNodes.length),e=r}if(i.length>0&&3==l.nodeType){for(a=l.previousSibling;a&&3==a.nodeType;)i[i.length-1]--,a=a.previousSibling;for(a=l.nextSibling;a&&3==a.nodeType;)d[d.length-1]++,a=a.nextSibling}return{o:i,r:d}},getNode:function(t,a){if(!r.isArray(t)||0==t.length)return a;var i=a;return e.every(t,function(e){return e>=0&&e<i.childNodes.length?(i=i.childNodes[e],!0):(i=null,!1)}),i},getCommonAncestor:function(e,t,r){r=r||e.ownerDocument.body;for(var a=function(e){for(var t=[];e&&(t.unshift(e),e!==r);)e=e.parentNode;return t},i=a(e),d=a(t),l=Math.min(i.length,d.length),o=i[0],n=1;n<l&&i[n]===d[n];n++)o=i[n];return o},getAncestor:function(e,t,r){for(r=r||e.ownerDocument.body;e&&e!==r;){var a=e.nodeName.toUpperCase();if(t.test(a))return e;e=e.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(e,t,r){r=r||e.ownerDocument.body,t=t||a.BlockTagNames;for(var i,d=null;e&&e!==r;){var l=e.nodeName.toUpperCase();!d&&t.test(l)&&(d=e),!i&&/^(?:BODY|TD|TH|CAPTION)$/.test(l)&&(i=e),e=e.parentNode}return{blockNode:d,blockContainer:i||e.ownerDocument.body}},atBeginningOfContainer:function(e,t,r){var a=!1,i=0==r;if(i||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(0,r))&&(i=!0),i){var d=t;for(a=!0;d&&d!==e;){if(d.previousSibling){a=!1;break}d=d.parentNode}}return a},atEndOfContainer:function(e,t,r){var a=!1,i=r==(t.length||t.childNodes.length);if(i||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(r))&&(i=!0),i){var d=t;for(a=!0;d&&d!==e;){if(d.nextSibling){a=!1;break}d=d.parentNode}}return a},adjacentNoneTextNode:function(e,t){for(var r=e,a=0-e.length||0,i=t?"nextSibling":"previousSibling";r&&3==r.nodeType;)a+=r.length,r=r[i];return[r,a]},create:function(e){return e=e||window,e.getSelection?e.document.createRange():new d},getSelection:function(e,t){if(e.getSelection)return e.getSelection();var r=new i.selection(e);return t||r._getCurrentSelection(),r}};if(!window.getSelection)var i=a.ie={cachedSelection:{},selection:function(e){this._ranges=[],this.addRange=function(e,t){this._ranges.push(e),t||e._select(),this.rangeCount=this._ranges.length},this.removeAllRanges=function(){this._ranges=[],this.rangeCount=0};var t=function(){var t=e.document.selection.createRange(),r=e.document.selection.type.toUpperCase();return new d("CONTROL"==r?i.decomposeControlRange(t):i.decomposeTextRange(t))};this.getRangeAt=function(e){return this._ranges[e]},this._getCurrentSelection=function(){this.removeAllRanges();var e=t();e?(this.addRange(e,!0),this.isCollapsed=e.collapsed):this.isCollapsed=!0}},decomposeControlRange:function(e){var t=e.item(0),r=e.item(e.length-1),i=t.parentNode,d=r.parentNode;return[i,a.getIndex(t,i).o[0],d,a.getIndex(r,d).o[0]+1]},getEndPoint:function(t,r){var i=t.duplicate();i.collapse(!r);var d,l,o,n="EndTo"+(r?"End":"Start"),s=i.parentElement();if(s.childNodes.length>0?e.every(s.childNodes,function(e,r){var f;if(3!=e.nodeType){if(i.moveToElementText(e),i.compareEndPoints(n,t)>0){if(!o||3!=o.nodeType)return d=s,l=r,!1;d=o,f=!0}else if(r==s.childNodes.length-1)return d=s,l=s.childNodes.length,!1}else r==s.childNodes.length-1&&(d=e,f=!0);if(f&&d){var m=a.adjacentNoneTextNode(d)[0];d=m?m.nextSibling:s.firstChild;var u=a.adjacentNoneTextNode(d);m=u[0];var v=u[1];return m?(i.moveToElementText(m),i.collapse(!1)):i.moveToElementText(s),i.setEndPoint(n,t),l=i.text.length-v,!1}return o=e,!0}):(d=s,l=0),!r&&1==d.nodeType&&l==d.childNodes.length){var f=d.nextSibling;f&&3==f.nodeType&&(d=f,l=0)}return[d,l]},setEndPoint:function(e,t,r){var i,d,l=e.duplicate();if(3!=t.nodeType)if(r>0){if(i=t.childNodes[r-1])if(3==i.nodeType)t=i,r=i.length;else if(i.nextSibling&&3==i.nextSibling.nodeType)t=i.nextSibling,r=0;else{l.moveToElementText(i.nextSibling?i:t);var o=i.parentNode,n=o.insertBefore(i.ownerDocument.createTextNode(" "),i.nextSibling);l.collapse(!1),o.removeChild(n)}}else l.moveToElementText(t),l.collapse(!0);if(3==t.nodeType){var s=a.adjacentNoneTextNode(t),f=s[0];d=s[1],f?(l.moveToElementText(f),l.collapse(!1),"inherit"!=f.contentEditable&&d++):(l.moveToElementText(t.parentNode),l.collapse(!0),l.move("character",1),l.move("character",-1)),r+=d,r>0&&l.move("character",r)!=r&&console.error("Error when moving!")}return l},decomposeTextRange:function(e){var t=i.getEndPoint(e),r=t[0],a=t[1],d=t[0],l=t[1];return e.htmlText.length&&(e.htmlText==e.text?l=a+e.text.length:(t=i.getEndPoint(e,!0),d=t[0],l=t[1])),[r,a,d,l]},setRange:function(e,t,r,a,d,l){var o=i.setEndPoint(e,t,r);if(e.setEndPoint("StartToStart",o),!l)var n=i.setEndPoint(e,a,d);return e.setEndPoint("EndToEnd",n||o),e}},d=a.W3CRange=t(null,{constructor:function(){arguments.length>0?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.startContainer!==this.endContainer?this.commonAncestorContainer=a.getCommonAncestor(this.startContainer,this.endContainer):this.commonAncestorContainer=this.startContainer,this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(e,t){t=parseInt(t),this.startContainer===e&&this.startOffset==t||(delete this._cachedBookmark,this.startContainer=e,this.startOffset=t,this.endContainer?this._updateInternal():this.setEnd(e,t))},setEnd:function(e,t){t=parseInt(t),this.endContainer===e&&this.endOffset==t||(delete this._cachedBookmark,this.endContainer=e,this.endOffset=t,this.startContainer?this._updateInternal():this.setStart(e,t))},setStartAfter:function(e,t){this._setPoint("setStart",e,t,1)},setStartBefore:function(e,t){this._setPoint("setStart",e,t,0)},setEndAfter:function(e,t){this._setPoint("setEnd",e,t,1)},setEndBefore:function(e,t){this._setPoint("setEnd",e,t,0)},_setPoint:function(e,t,r,i){var d=a.getIndex(t,t.parentNode).o;this[e](t.parentNode,d.pop()+i)},_getIERange:function(){var e=(this._body||this.endContainer.ownerDocument.body).createTextRange();return i.setRange(e,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed),e},getBookmark:function(){return this._getIERange(),this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var e=this.startContainer,t=this._getIERange();3!==e.nodeType||this.startOffset||this.setStartBefore(e),t.pasteHTML(""),this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.collapsed=!0},cloneRange:function(){var e=new d([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);return e._body=this._body,e},detach:function(){this._body=null,this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0}});return r.setObject("dijit.range",a),a});//# sourceMappingURL=range.js.map