//>>built
define("dijit/_editor/plugins/FullScreen",["dojo/aspect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/i18n","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","dojo/_base/window","dojo/window","../../focus","../_Plugin","../../form/ToggleButton","../../registry","dojo/i18n!../nls/commands"],function(e,t,r,a,i,d,l,o,n,s,f,m,u,v,h,y){var w=t("dijit._editor.plugins.FullScreen",v,{zIndex:500,_origState:null,_origiFrameState:null,_resizeHandle:null,isFullscreen:!1,toggle:function(){this.button.set("checked",!this.button.get("checked"))},_initButton:function(){var e=d.getLocalization("dijit._editor","commands"),t=this.editor;this.button=new h({label:e.fullScreen,ownerDocument:t.ownerDocument,dir:t.dir,lang:t.lang,showLabel:!1,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"FullScreen",tabIndex:"-1",onChange:o.hitch(this,"_setFullScreen")})},setEditor:function(e){this.editor=e,this._initButton(),this.editor.addKeyHandler(l.F11,!0,!0,o.hitch(this,function(e){return this.toggle(),e.stopPropagation(),e.preventDefault(),this.editor.defer("focus",250),!0})),this.own(n(this.editor.domNode,"keydown",o.hitch(this,"_containFocus")))},_containFocus:function(e){if(this.isFullscreen){var t=this.editor;if(!t.isTabIndent&&t._fullscreen_oldOnKeyDown&&e.keyCode===l.TAB){var r=u.curNode,a=this._getAltViewNode();r==t.iframe||a&&r===a?setTimeout(o.hitch(this,function(){t.toolbar.focus()}),10):a&&"none"===i.get(t.iframe,"display")?setTimeout(o.hitch(this,function(){u.focus(a)}),10):setTimeout(o.hitch(this,function(){t.focus()}),10),event.stopPropagation(),event.preventDefault()}else t._fullscreen_oldOnKeyDown&&t._fullscreen_oldOnKeyDown(e)}},_resizeEditor:function(){var e=m.getBox(this.editor.ownerDocument);a.setMarginBox(this.editor.domNode,{w:e.w,h:e.h});var t=this.editor.getHeaderHeight(),r=this.editor.getFooterHeight(),i=a.getPadBorderExtents(this.editor.domNode),d=a.getPadBorderExtents(this.editor.iframe.parentNode),l=a.getMarginExtents(this.editor.iframe.parentNode),o=e.h-(t+i.h+r);a.setMarginBox(this.editor.iframe.parentNode,{h:o,w:e.w}),a.setMarginBox(this.editor.iframe,{h:o-(d.h+l.h)})},_getAltViewNode:function(){},_setFullScreen:function(t){var d=this.editor,l=d.ownerDocumentBody,f=d.domNode.parentNode,u=m.getBox(d.ownerDocument);if(this.isFullscreen=t,t){for(;f&&f!==l;)r.add(f,"dijitForceStatic"),f=f.parentNode;this._editorResizeHolder=this.editor.resize,d.resize=function(){},d._fullscreen_oldOnKeyDown=d.onKeyDown,d.onKeyDown=o.hitch(this,this._containFocus),this._origState={},this._origiFrameState={};var v=d.domNode,h=v&&v.style||{};this._origState={width:h.width||"",height:h.height||"",top:i.get(v,"top")||"",left:i.get(v,"left")||"",position:i.get(v,"position")||"static",marginBox:a.getMarginBox(d.domNode)};var w=d.iframe,c=w&&w.style||{},M=i.get(d.iframe,"backgroundColor");if(this._origiFrameState={backgroundColor:M||"transparent",width:c.width||"auto",height:c.height||"auto",zIndex:c.zIndex||""},i.set(d.domNode,{position:"absolute",top:"0px",left:"0px",zIndex:this.zIndex,width:u.w+"px",height:u.h+"px"}),i.set(d.iframe,{height:"100%",width:"100%",zIndex:this.zIndex,backgroundColor:"transparent"!==M&&"rgba(0, 0, 0, 0)"!==M?M:"white"}),i.set(d.iframe.parentNode,{height:"95%",width:"100%"}),l.style&&l.style.overflow?this._oldOverflow=i.get(l,"overflow"):this._oldOverflow="",s("ie")&&!s("quirks")){if(l.parentNode&&l.parentNode.style&&l.parentNode.style.overflow)this._oldBodyParentOverflow=l.parentNode.style.overflow;else try{this._oldBodyParentOverflow=i.get(l.parentNode,"overflow")}catch(e){this._oldBodyParentOverflow="scroll"}i.set(l.parentNode,"overflow","hidden")}i.set(l,"overflow","hidden");var p=function(){var e=m.getBox(d.ownerDocument);if("_prevW"in this&&"_prevH"in this){if(e.w===this._prevW&&e.h===this._prevH)return}else this._prevW=e.w,this._prevH=e.h;this._resizer&&(clearTimeout(this._resizer),delete this._resizer),this._resizer=setTimeout(o.hitch(this,function(){delete this._resizer,this._resizeEditor()}),10)};this._resizeHandle=n(window,"resize",o.hitch(this,p)),this._resizeHandle2=e.after(d,"onResize",o.hitch(this,function(){this._resizer&&(clearTimeout(this._resizer),delete this._resizer),this._resizer=setTimeout(o.hitch(this,function(){delete this._resizer,this._resizeEditor()}),10)})),this._resizeEditor();var g=this.editor.toolbar.domNode;setTimeout(function(){m.scrollIntoView(g)},250)}else{for(this._resizeHandle&&(this._resizeHandle.remove(),this._resizeHandle=null),this._resizeHandle2&&(this._resizeHandle2.remove(),this._resizeHandle2=null),this._rst&&(clearTimeout(this._rst),this._rst=null);f&&f!==l;)r.remove(f,"dijitForceStatic"),f=f.parentNode;if(this._editorResizeHolder&&(this.editor.resize=this._editorResizeHolder),!this._origState&&!this._origiFrameState)return;d._fullscreen_oldOnKeyDown&&(d.onKeyDown=d._fullscreen_oldOnKeyDown,delete d._fullscreen_oldOnKeyDown);var k=this;setTimeout(function(){var e=k._origState.marginBox,t=k._origState.height;s("ie")&&!s("quirks")&&(l.parentNode.style.overflow=k._oldBodyParentOverflow,delete k._oldBodyParentOverflow),i.set(l,"overflow",k._oldOverflow),delete k._oldOverflow,i.set(d.domNode,k._origState),i.set(d.iframe.parentNode,{height:"",width:""}),i.set(d.iframe,k._origiFrameState),delete k._origState,delete k._origiFrameState;var r=y.getEnclosingWidget(d.domNode.parentNode);r&&r.resize?r.resize():(!t||t.indexOf("%")<0)&&setTimeout(o.hitch(this,function(){d.resize({h:e.h})}),0),m.scrollIntoView(k.editor.toolbar.domNode)},100)}},updateState:function(){this.button.set("disabled",this.get("disabled"))},destroy:function(){this._resizeHandle&&(this._resizeHandle.remove(),this._resizeHandle=null),this._resizeHandle2&&(this._resizeHandle2.remove(),this._resizeHandle2=null),this._resizer&&(clearTimeout(this._resizer),this._resizer=null),this.inherited(arguments)}});return v.registry.fullScreen=v.registry.fullscreen=function(e){return new w({zIndex:"zIndex"in e?e.zIndex:500})},w});//# sourceMappingURL=FullScreen.js.map