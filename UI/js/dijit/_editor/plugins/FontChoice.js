//>>built
define("dijit/_editor/plugins/FontChoice",["require","dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/i18n","dojo/_base/lang","dojo/string","dojo/store/Memory","../../registry","../../_Widget","../../_TemplatedMixin","../../_WidgetsInTemplateMixin","../../form/FilteringSelect","../_Plugin","../range","dojo/i18n!../nls/FontChoice"],function(e,t,r,a,i,d,l,o,n,s,f,m,u,v,h){var y=r("dijit._editor.plugins._FontDropDown",[s,f,m],{label:"",plainText:!1,templateString:"<span style='white-space: nowrap' class='dijit dijitReset dijitInline'><label class='dijitLeft dijitInline' for='${selectId}'>${label}</label><input data-dojo-type='../../form/FilteringSelect' required='false' data-dojo-props='labelType:\"html\", labelAttr:\"label\", searchAttr:\"name\"' class='${comboClass}' tabIndex='-1' id='${selectId}' data-dojo-attach-point='select' value=''/></span>",contextRequire:e,postMixInProperties:function(){this.inherited(arguments),this.strings=i.getLocalization("dijit._editor","FontChoice"),this.label=this.strings[this.command],this.id=n.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.selectId=this.id+"_select",this.inherited(arguments)},postCreate:function(){this.select.set("store",new o({idProperty:"value",data:t.map(this.values,function(e){var t=this.strings[e]||e;return{label:this.getLabel(e,t),name:t,value:e}},this)})),this.select.set("value","",!1),this.disabled=this.select.get("disabled")},_setValueAttr:function(e,r){r=!1!==r,this.select.set("value",t.indexOf(this.values,e)<0?"":e,r),r||(this.select._lastValueReported=null)},_getValueAttr:function(){return this.select.get("value")},focus:function(){this.select.focus()},_setDisabledAttr:function(e){this._set("disabled",e),this.select.set("disabled",e)}}),w=r("dijit._editor.plugins._FontNameDropDown",y,{generic:!1,command:"fontName",comboClass:"dijitFontNameCombo",postMixInProperties:function(){this.values||(this.values=this.generic?["serif","sans-serif","monospace","cursive","fantasy"]:["Arial","Times New Roman","Comic Sans MS","Courier New"]),this.inherited(arguments)},getLabel:function(e,t){return this.plainText?t:"<div style='font-family: "+e+"'>"+t+"</div>"},_normalizeFontName:function(e){var r=this.values;if(!e||!r)return e;var a=e.split(",");if(a.length>1)for(var i=0,d=a.length;i<d;i++){var o=l.trim(a[i]),n=t.indexOf(r,o);if(n>-1)return o}return e},_setValueAttr:function(e,t){if(t=!1!==t,e=this._normalizeFontName(e),this.generic){e={Arial:"sans-serif",Helvetica:"sans-serif",Myriad:"sans-serif",Times:"serif","Times New Roman":"serif","Comic Sans MS":"cursive","Apple Chancery":"cursive",Courier:"monospace","Courier New":"monospace",Papyrus:"fantasy","Estrangelo Edessa":"cursive",Gabriola:"fantasy"}[e]||e}this.inherited(arguments,[e,t])}}),c=r("dijit._editor.plugins._FontSizeDropDown",y,{command:"fontSize",comboClass:"dijitFontSizeCombo",values:[1,2,3,4,5,6,7],getLabel:function(e,t){return this.plainText?t:"<font size="+e+"'>"+t+"</font>"},_setValueAttr:function(e,t){if(t=!1!==t,e.indexOf&&-1!=e.indexOf("px")){e={10:1,13:2,16:3,18:4,24:5,32:6,48:7}[parseInt(e,10)]||e}this.inherited(arguments,[e,t])}}),M=r("dijit._editor.plugins._FormatBlockDropDown",y,{command:"formatBlock",comboClass:"dijitFormatBlockCombo",values:["noFormat","p","h1","h2","h3","pre"],postCreate:function(){this.inherited(arguments),this.set("value","noFormat",!1)},getLabel:function(e,t){return this.plainText||"noFormat"==e?t:"<"+e+">"+t+"</"+e+">"},_execCommand:function(e,r,a){if("noFormat"===a){var i,l,o=h.getSelection(e.window);if(o&&o.rangeCount>0){var n,s,f=o.getRangeAt(0);if(f){for(i=f.startContainer,l=f.endContainer;i&&i!==e.editNode&&i!==e.document.body&&1!==i.nodeType;)i=i.parentNode;for(;l&&l!==e.editNode&&l!==e.document.body&&1!==l.nodeType;)l=l.parentNode;var m=d.hitch(this,function(r,a){if(r.childNodes&&r.childNodes.length){var i;for(i=0;i<r.childNodes.length;i++){var d=r.childNodes[i];if(1==d.nodeType&&e.selection.inSelection(d)){var l=d.tagName?d.tagName.toLowerCase():"";-1!==t.indexOf(this.values,l)&&a.push(d),m(d,a)}}}}),u=d.hitch(this,function(t){if(t&&t.length){for(e.beginEditing();t.length;)this._removeFormat(e,t.pop());e.endEditing()}}),v=[];if(i==l){var y;for(n=i;n&&n!==e.editNode&&n!==e.document.body;){if(1==n.nodeType&&(s=n.tagName?n.tagName.toLowerCase():"",-1!==t.indexOf(this.values,s))){y=n;break}n=n.parentNode}m(i,v),y&&(v=[y].concat(v)),u(v)}else{for(n=i;e.selection.inSelection(n);)1==n.nodeType&&(s=n.tagName?n.tagName.toLowerCase():"",-1!==t.indexOf(this.values,s)&&v.push(n),m(n,v)),n=n.nextSibling;u(v)}e.onDisplayChanged()}}}else e.execCommand(r,a)},_removeFormat:function(e,t){if(e.customUndo){for(;t.firstChild;)a.place(t.firstChild,t,"before");t.parentNode.removeChild(t)}else{e.selection.selectElementChildren(t);var r=e.selection.getSelectedHtml();e.selection.selectElement(t),e.execCommand("inserthtml",r||"")}}}),p=r("dijit._editor.plugins.FontChoice",v,{useDefaultCommand:!1,_initButton:function(){var e={fontName:w,fontSize:c,formatBlock:M}[this.command],t=this.params;this.params.custom&&(t.values=this.params.custom);var r=this.editor;this.button=new e(d.delegate({dir:r.dir,lang:r.lang},t)),this.own(this.button.select.on("change",d.hitch(this,function(e){this.editor.focused&&this.editor.focus(),"fontName"==this.command&&-1!=e.indexOf(" ")&&(e="'"+e+"'"),this.button._execCommand?this.button._execCommand(this.editor,this.command,e):this.editor.execCommand(this.command,e)})))},updateState:function(){var e=this.editor,r=this.command;if(e&&e.isLoaded&&r.length&&this.button){var a=this.get("disabled");if(this.button.set("disabled",a),a)return;var i;try{i=e.queryCommandValue(r)||""}catch(e){i=""}var l=d.isString(i)&&(i.match(/'([^']*)'/)||i.match(/"([^"]*)"/));if(l&&(i=l[1]),"fontSize"!==r||i||(i=3),"formatBlock"===r)if(i&&"p"!=i)t.indexOf(this.button.values,i)<0&&(i="noFormat");else{i=null;var o,n=h.getSelection(this.editor.window);if(n&&n.rangeCount>0){var s=n.getRangeAt(0);s&&(o=s.endContainer)}for(;o&&o!==e.editNode&&o!==e.document;){var f=o.tagName?o.tagName.toLowerCase():"";if(f&&t.indexOf(this.button.values,f)>-1){i=f;break}o=o.parentNode}i||(i="noFormat")}i!==this.button.get("value")&&this.button.set("value",i,!1)}}});return t.forEach(["fontName","fontSize","formatBlock"],function(e){v.registry[e]=function(t){return new p({command:e,plainText:t.plainText})}}),p._FontDropDown=y,p._FontNameDropDown=w,p._FontSizeDropDown=c,p._FormatBlockDropDown=M,p});//# sourceMappingURL=FontChoice.js.map