//>>built
define("dijit/_editor/RichText",["dojo/_base/array","dojo/_base/config","dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/_base/kernel","dojo/keys","dojo/_base/lang","dojo/on","dojo/query","dojo/domReady","dojo/sniff","dojo/string","dojo/topic","dojo/_base/unload","dojo/_base/url","dojo/window","../_Widget","../_CssStateMixin","../selection","./range","./html","../focus","../main"],function(e,r,t,a,i,d,l,o,n,s,f,m,u,v,h,y,w,c,M,p,g,k,b,F,I,j,z,A,E){var q=t("dijit._editor.RichText",[b,F],{constructor:function(e){this.contentPreFilters=[],this.contentPostFilters=[],this.contentDomPreFilters=[],this.contentDomPostFilters=[],this.editingAreaStyleSheets=[],this.events=[].concat(this.events),this._keyHandlers={},e&&u.isString(e.value)&&(this.value=e.value),this.onLoadDeferred=new a},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){this.domNode.tagName.toLowerCase(),this.contentPreFilters=[u.trim,u.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters),w("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters)),w("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters)),(w("ie")||w("trident"))&&(this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[u.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters)),this.contentDomPostFilters=[u.hitch(this,"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters),this.inherited(arguments),M.publish(E._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments),this.open(),this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var e=u.hitch(this,function(e,r){return function(){return!this.execCommand(e,r)}}),r={b:e("bold"),i:e("italic"),u:e("underline"),a:e("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:e("formatblock","h1"),2:e("formatblock","h2"),3:e("formatblock","h3"),4:e("formatblock","h4"),"\\":e("insertunorderedlist")};w("ie")||(r.Z=e("redo"));var t;for(t in r)this.addKeyHandler(t,!0,!1,r[t])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(q._editorCommandsLocalized)return this._local2NativeFormatNames=q._local2NativeFormatNames,void(this._native2LocalFormatNames=q._native2LocalFormatNames);q._editorCommandsLocalized=!0,q._local2NativeFormatNames={},q._native2LocalFormatNames={},this._local2NativeFormatNames=q._local2NativeFormatNames,this._native2LocalFormatNames=q._native2LocalFormatNames;for(var e,r=["div","p","pre","h1","h2","h3","h4","h5","h6","ol","ul","address"],t="",a=0;e=r[a++];)"l"!==e.charAt(1)?t+="<"+e+"><span>content</span></"+e+"><br/>":t+="<"+e+"><li>content</li></"+e+"><br/>";var i={position:"absolute",top:"0px",zIndex:10,opacity:.01},d=o.create("div",{style:i,innerHTML:t});this.ownerDocumentBody.appendChild(d);var l=u.hitch(this,function(){for(var e=d.firstChild;e;)try{this.selection.selectElement(e.firstChild);var r=e.tagName.toLowerCase();this._local2NativeFormatNames[r]=document.queryCommandValue("formatblock"),this._native2LocalFormatNames[this._local2NativeFormatNames[r]]=r,e=e.nextSibling.nextSibling}catch(e){}o.destroy(d)});this.defer(l)},open:function(e){(!this.onLoadDeferred||this.onLoadDeferred.fired>=0)&&(this.onLoadDeferred=new a),this.isClosed||this.close(),M.publish(E._scopeName+"._editor.RichText::open",this),1===arguments.length&&e.nodeName&&(this.domNode=e);var t,n=this.domNode;if(u.isString(this.value))t=this.value,n.innerHTML="";else if(n.nodeName&&"textarea"==n.nodeName.toLowerCase()){var f=this.textarea=n;this.name=f.name,t=f.value,n=this.domNode=this.ownerDocument.createElement("div"),n.setAttribute("widgetId",this.id),f.removeAttribute("widgetId"),n.cssText=f.cssText,n.className+=" "+f.className,o.place(n,f,"before");var m=u.hitch(this,function(){if(s.set(f,{display:"block",position:"absolute",top:"-1000px"}),w("ie")){var e=f.style;this.__overflow=e.overflow,e.overflow="hidden"}});if(w("ie")?this.defer(m,10):m(),f.form){var h=f.value;this.reset=function(){this.getValue()!==h&&this.replaceValue(h)},v(f.form,"submit",u.hitch(this,function(){d.set(f,"disabled",this.disabled),f.value=this.getValue()}))}}else t=z.getChildrenHtml(n),n.innerHTML="";if(this.value=t,n.nodeName&&"LI"===n.nodeName&&(n.innerHTML=" <br>"),this.header=n.ownerDocument.createElement("div"),n.appendChild(this.header),this.editingArea=n.ownerDocument.createElement("div"),n.appendChild(this.editingArea),this.footer=n.ownerDocument.createElement("div"),n.appendChild(this.footer),this.name||(this.name=this.id+"_AUTOGEN"),""!==this.name&&(!r.useXDomain||r.allowXdRichTextSave)){var y=i.byId(E._scopeName+"._editor.RichText.value");if(y&&""!==y.value)for(var c,g=y.value.split(this._SEPARATOR),k=0;c=g[k++];){var b=c.split(this._NAME_CONTENT_SEP);if(b[0]===this.name){this.value=b[1],g=g.splice(k,1),y.value=g.join(this._SEPARATOR);break}}q._globalSaveHandler||(q._globalSaveHandler={},p.addOnUnload(function(){var e;for(e in q._globalSaveHandler){var r=q._globalSaveHandler[e];u.isFunction(r)&&r()}})),q._globalSaveHandler[this.id]=u.hitch(this,"_saveContent")}this.isClosed=!1;var F=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");F.id=this.id+"_iframe",F.style.border="none",F.style.width="100%",this._layoutMode?F.style.height="100%":w("ie")>=7?(this.height&&(F.style.height=this.height),this.minHeight&&(F.style.minHeight=this.minHeight)):F.style.height=this.height?this.height:this.minHeight,F.frameBorder=0,F._loadFunc=u.hitch(this,function(e){this.window=e,this.document=e.document,this.selection=new I.SelectionManager(e),w("ie")&&this._localizeEditorCommands(),this.onLoad(this.get("value"))});var j,A=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");j=w("ie")<11?'javascript:document.open();try{parent.window;}catch(e){document.domain="'+document.domain+"\";}document.write('"+A+"');document.close()":"javascript: '"+A+"'",this.editingArea.appendChild(F),F.src=j,"LI"===n.nodeName&&(n.lastChild.style.marginTop="-1.2em"),l.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var e,r=s.getComputedStyle(this.domNode);if(this["aria-label"])e=this["aria-label"];else{var t=h('label[for="'+this.id+'"]',this.ownerDocument)[0]||i.byId(this["aria-labelledby"],this.ownerDocument);t&&(e=t.textContent||t.innerHTML||"")}var a="<div id='dijitEditorBody' role='textbox' aria-multiline='true' "+(e?" aria-label='"+c.escape(e)+"'":"")+"></div>",d=[r.fontWeight,r.fontSize,r.fontFamily].join(" "),l=r.lineHeight;l=l.indexOf("px")>=0?parseFloat(l)/parseFloat(r.fontSize):l.indexOf("em")>=0?parseFloat(l):"normal";var o="",n=this;return this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/gi,function(e){e=e.replace(/^;/gi,"")+";";var r=e.split(":")[0];if(r){r=u.trim(r),r=r.toLowerCase();var t,a="";for(t=0;t<r.length;t++){var i=r.charAt(t);switch(i){case"-":t++,i=r.charAt(t).toUpperCase();default:a+=i}}s.set(n.domNode,a,"")}o+=e+";"}),this.iframe.setAttribute("title",e),["<!DOCTYPE html>","<html lang='"+(this.lang||f.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir='rtl'")+">\n","<head>\n","<meta http-equiv='Content-Type' content='text/html'>\n",e?"<title>"+c.escape(e)+"</title>":"","<style>\n","\tbody,html {\n","\t\tbackground:transparent;\n","\t\tpadding: 1px 0 0 0;\n","\t\tmargin: -1px 0 0 0;\n","\t}\n","\tbody,html,#dijitEditorBody { outline: none; }","html { height: 100%; width: 100%; overflow: hidden; }\n",this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n","\t\ttop:0px;\n","\t\tleft:0px;\n","\t\tright:0px;\n","\t\tfont:",d,";\n",this.height||w("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",l,";\n","\t}\n","\tp{ margin: 1em 0; }\n","\tli > ul:-moz-first-node, li > ol:-moz-first-node{ padding-top: 1.2em; }\n",w("ie")||w("trident")||w("edge")?"":"\tli{ min-height:1.2em; }\n","</style>\n",this._applyEditingAreaStyleSheets(),"\n","</head>\n<body role='application'",e?" aria-label='"+c.escape(e)+"'":"","onload='try{frameElement && frameElement._loadFunc(window,document)}catch(e){document.domain=\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style='"+o+"'>",a,"</body>\n</html>"].join("")},_applyEditingAreaStyleSheets:function(){var e=[];this.styleSheets&&(e=this.styleSheets.split(";"),this.styleSheets=""),e=e.concat(this.editingAreaStyleSheets),this.editingAreaStyleSheets=[];for(var r,t="",a=0,i=k.get(this.ownerDocument);r=e[a++];){var d=new g(i.location,r).toString();this.editingAreaStyleSheets.push(d),t+='<link rel="stylesheet" type="text/css" href="'+d+'"/>'}return t},addStyleSheet:function(r){var t=r.toString(),a=k.get(this.ownerDocument);("."===t.charAt(0)||"/"!==t.charAt(0)&&!r.host)&&(t=new g(a.location,t).toString()),e.indexOf(this.editingAreaStyleSheets,t)>-1||(this.editingAreaStyleSheets.push(t),this.onLoadDeferred.then(u.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(t);else{var e=this.document.getElementsByTagName("head")[0],r=this.document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=t,e.appendChild(r)}})))},removeStyleSheet:function(r){var t=r.toString(),a=k.get(this.ownerDocument);("."===t.charAt(0)||"/"!==t.charAt(0)&&!r.host)&&(t=new g(a.location,t).toString());var i=e.indexOf(this.editingAreaStyleSheets,t);-1!==i&&(delete this.editingAreaStyleSheets[i],h('link[href="'+t+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(e){if(e=!!e,this._set("disabled",e),this.isLoaded){var r=w("ie")&&(this.isLoaded||!this.focusOnLoad);if(r&&(this.editNode.unselectable="on"),this.editNode.contentEditable=!e,this.editNode.tabIndex=e?"-1":this.tabIndex,r&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")}),w("mozilla")&&!e&&this._mozSettingProps){var t,a=this._mozSettingProps;for(t in a)if(a.hasOwnProperty(t))try{this.document.execCommand(t,!1,a[t])}catch(e){}}this._disabledOK=!0}},onLoad:function(r){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=A.registerIframe(this.iframe)),this.editNode=this.document.body.firstChild;var t=this;this.beforeIframeNode=o.place("<div tabIndex=-1></div>",this.iframe,"before"),this.afterIframeNode=o.place("<div tabIndex=-1></div>",this.iframe,"after"),this.iframe.onfocus=this.document.onfocus=function(){t.editNode.focus()},this.focusNode=this.editNode;var a=this.events.concat(this.captureEvents),i=this.iframe?this.document:this.editNode;if(this.own.apply(this,e.map(a,function(e){var r=e.toLowerCase().replace(/^on/,"");return v(i,r,u.hitch(this,e))},this)),this.own(v(i,"mouseup",u.hitch(this,"onClick"))),w("ie")&&(this.own(v(this.document,"mousedown",u.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1),w("webkit")&&(this._webkitListener=this.own(v(this.document,"mouseup",u.hitch(this,"onDisplayChanged")))[0],this.own(v(this.document,"mousedown",u.hitch(this,function(e){var r=e.target;!r||r!==this.document.body&&r!==this.document||this.defer("placeCursorAtEnd")})))),w("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(e){}this.isLoaded=!0,this.set("disabled",this.disabled);var d=u.hitch(this,function(){this.setValue(r),this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0),this.onDisplayChanged(),this.focusOnLoad&&y(u.hitch(this,"defer","focus",this.updateInterval)),this.value=this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(d):d()},onKeyDown:function(r){if(r.keyCode===m.SHIFT||r.keyCode===m.ALT||r.keyCode===m.META||r.keyCode===m.CTRL)return!0;if(r.keyCode===m.TAB&&this.isTabIndent&&(r.stopPropagation(),r.preventDefault(),this.queryCommandEnabled(r.shiftKey?"outdent":"indent")&&this.execCommand(r.shiftKey?"outdent":"indent")),r.keyCode==m.TAB&&!this.isTabIndent&&!r.ctrlKey&&!r.altKey)return r.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),!0;w("ie")<9&&r.keyCode===m.BACKSPACE&&"Control"===this.document.selection.type&&(r.stopPropagation(),r.preventDefault(),this.execCommand("delete")),w("ff")&&(r.keyCode!==m.PAGE_UP&&r.keyCode!==m.PAGE_DOWN||this.editNode.clientHeight>=this.editNode.scrollHeight&&r.preventDefault());var t=this._keyHandlers[r.keyCode],a=arguments;return t&&!r.altKey&&e.some(t,function(e){if(!(e.shift^r.shiftKey||e.ctrl^(r.ctrlKey||r.metaKey)))return e.handler.apply(this,a)||r.preventDefault(),!0},this),this.defer("onKeyPressed",1),!0},onKeyUp:function(){},setDisabled:function(e){f.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2),this.set("disabled",e)},_setValueAttr:function(e){this.setValue(e)},_setDisableSpellCheckAttr:function(e){this.document?d.set(this.document.body,"spellcheck",!e):this.onLoadDeferred.then(u.hitch(this,function(){d.set(this.document.body,"spellcheck",!e)})),this._set("disableSpellCheck",e)},addKeyHandler:function(e,r,t,a){"string"==typeof e&&(e=e.toUpperCase().charCodeAt(0)),u.isArray(this._keyHandlers[e])||(this._keyHandlers[e]=[]),this._keyHandlers[e].push({shift:t||!1,ctrl:r||!1,handler:a})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(e){this.onDisplayChanged(e)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(e){(w("ie")||w("trident"))&&this.defer(function(){A.curNode||this.ownerDocumentBody.focus()}),this.inherited(arguments);var r=this.getValue(!0);r!==this.value&&this.onChange(r),this._set("value",r)},_onFocus:function(e){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!w("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){if(!this.isLoaded)return void(this.focusOnLoad=!0);w("ie")<9?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus()},updateInterval:200,_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove(),this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(e,r){var t=e.toLowerCase();return"formatblock"===t?w("safari")&&void 0===r&&(t="heading"):"hilitecolor"!==t||w("mozilla")||(t="backcolor"),t},_implCommand:function(e){return"_"+this._normalizeCommand(e)+"EnabledImpl"},_qcaCache:{},queryCommandAvailable:function(e){var r=this._qcaCache[e];return void 0!==r?r:this._qcaCache[e]=this._queryCommandAvailable(e)},_queryCommandAvailable:function(e){switch(e.toLowerCase()){case"bold":case"italic":case"underline":case"subscript":case"superscript":case"fontname":case"fontsize":case"forecolor":case"hilitecolor":case"justifycenter":case"justifyfull":case"justifyleft":case"justifyright":case"delete":case"selectall":case"toggledir":case"createlink":case"unlink":case"removeformat":case"inserthorizontalrule":case"insertimage":case"insertorderedlist":case"insertunorderedlist":case"indent":case"outdent":case"formatblock":case"inserthtml":case"undo":case"redo":case"strikethrough":case"tabindent":case"cut":case"copy":case"paste":return!0;case"blockdirltr":case"blockdirrtl":case"dirltr":case"dirrtl":case"inlinedirltr":case"inlinedirrtl":return w("ie")||w("trident")||w("edge");case"inserttable":case"insertcell":case"insertcol":case"insertrow":case"deletecells":case"deletecols":case"deleterows":case"mergecells":case"splitcell":return!w("webkit");default:return!1}},execCommand:function(e,r){var t;if(this.focused&&this.focus(),e=this._normalizeCommand(e,r),void 0!==r){if("heading"===e)throw new Error("unimplemented");"formatblock"===e&&(w("ie")||w("trident"))&&(r="<"+r+">")}var a="_"+e+"Impl";return this[a]?t=this[a](r):((r=arguments.length>1?r:null)||"createlink"!==e)&&(t=this.document.execCommand(e,!1,r)),this.onDisplayChanged(),t},queryCommandEnabled:function(e){if(this.disabled||!this._disabledOK)return!1;e=this._normalizeCommand(e);var r=this._implCommand(e);return this[r]?this[r](e):this._browserQueryCommandEnabled(e)},queryCommandState:function(e){if(this.disabled||!this._disabledOK)return!1;e=this._normalizeCommand(e);try{return this.document.queryCommandState(e)}catch(e){return!1}},queryCommandValue:function(e){if(this.disabled||!this._disabledOK)return!1;var r;if(e=this._normalizeCommand(e),w("ie")&&"formatblock"===e)r=this._native2LocalFormatNames[this.document.queryCommandValue(e)];else if(w("mozilla")&&"hilitecolor"===e){var t;try{t=this.document.queryCommandValue("styleWithCSS")}catch(e){t=!1}this.document.execCommand("styleWithCSS",!1,!0),r=this.document.queryCommandValue(e),this.document.execCommand("styleWithCSS",!1,t)}else r=this.document.queryCommandValue(e);return r},_sCall:function(e,r){return this.selection[e].apply(this.selection,r)},placeCursorAtStart:function(){this.focus();var e=!1;if(w("mozilla"))for(var r=this.editNode.firstChild;r;){if(3===r.nodeType){if(r.nodeValue.replace(/^\s+|\s+$/g,"").length>0){e=!0,this.selection.selectElement(r);break}}else if(1===r.nodeType){e=!0;var t=r.tagName?r.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(t)?this.selection.selectElement(r):this.selection.selectElementChildren(r);break}r=r.nextSibling}else e=!0,this.selection.selectElementChildren(this.editNode);e&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var e=!1;if(w("mozilla"))for(var r=this.editNode.lastChild;r;){if(3===r.nodeType){if(r.nodeValue.replace(/^\s+|\s+$/g,"").length>0){e=!0,this.selection.selectElement(r);break}}else if(1===r.nodeType){e=!0,this.selection.selectElement(r.lastChild||r);break}r=r.previousSibling}else e=!0,this.selection.selectElementChildren(this.editNode);e&&this.selection.collapse(!1)},getValue:function(e){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,e):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(e){if(!this.isLoaded)return void this.onLoadDeferred.then(u.hitch(this,function(){this.setValue(e)}));if(!this.textarea||!this.isClosed&&this.isLoaded){e=this._preFilterContent(e);var r=this.isClosed?this.domNode:this.editNode;r.innerHTML=e,this._preDomFilterContent(r)}else this.textarea.value=e;this.onDisplayChanged(),this._set("value",this.getValue(!0))},replaceValue:function(e){this.isClosed?this.setValue(e):this.window&&this.window.getSelection&&!w("mozilla")?this.setValue(e):this.window&&this.window.getSelection?(e=this._preFilterContent(e),this.execCommand("selectall"),this.execCommand("inserthtml",e),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(e),this._set("value",this.getValue(!0))},_preFilterContent:function(r){var t=r;return e.forEach(this.contentPreFilters,function(e){e&&(t=e(t))}),t},_preDomFilterContent:function(r){r=r||this.editNode,e.forEach(this.contentDomPreFilters,function(e){e&&u.isFunction(e)&&e(r)},this)},_postFilterContent:function(r,t){var a;return u.isString(r)?a=r:(r=r||this.editNode,this.contentDomPostFilters.length&&(t&&(r=u.clone(r)),e.forEach(this.contentDomPostFilters,function(e){r=e(r)})),a=z.getChildrenHtml(r)),u.trim(a.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(a=""),e.forEach(this.contentPostFilters,function(e){a=e(a)}),a},_saveContent:function(){var e=i.byId(E._scopeName+"._editor.RichText.value");e&&(e.value&&(e.value+=this._SEPARATOR),e.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(e,r){return e=e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;"),r||(e=e.replace(/'/gm,"&#39;")),e},getNodeHtml:function(e){return f.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",2),z.getNodeHtml(e)},getNodeChildrenHtml:function(e){return f.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2),z.getChildrenHtml(e)},close:function(e){if(!this.isClosed){if(arguments.length||(e=!0),e&&this._set("value",this.getValue(!0)),this.interval&&clearInterval(this.interval),this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener),w("ie")&&(this.iframe.onfocus=null),this.iframe._loadFunc=null,this._iframeRegHandle&&(this._iframeRegHandle.remove(),delete this._iframeRegHandle),this.textarea){var r=this.textarea.style;r.position="",r.left=r.top="",w("ie")&&(r.overflow=this.__overflow,this.__overflow=null),this.textarea.value=this.value,o.destroy(this.domNode),this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe,l.remove(this.domNode,this.baseClass),this.isClosed=!0,this.isLoaded=!1,delete this.editNode,delete this.focusNode,this.window&&this.window._frameElement&&(this.window._frameElement=null),this.window=null,this.document=null,this.editingArea=null,this.editorObject=null}},destroy:function(){this.isClosed||this.close(!1),this._updateTimer&&this._updateTimer.remove(),this.inherited(arguments),q._globalSaveHandler&&delete q._globalSaveHandler[this.id]},_removeMozBogus:function(e){return e.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(e){return e=e.replace(/\sclass="webkit-block-placeholder"/gi,""),e=e.replace(/\sclass="apple-style-span"/gi,""),e=e.replace(/<meta charset=\"utf-8\" \/>/gi,"")},_normalizeFontStyle:function(e){return e.replace(/<(\/)?strong([ \>])/gi,"<$1b$2").replace(/<(\/)?em([ \>])/gi,"<$1i$2")},_preFixUrlAttributes:function(e){return e.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2")},_browserQueryCommandEnabled:function(e){if(!e)return!1;var r=w("ie")<9?this.document.selection.createRange():this.document;try{return r.queryCommandEnabled(e)}catch(e){return!1}},_createlinkEnabledImpl:function(){var e=!0;if(w("opera")){e=!!this.window.getSelection().isCollapsed||this.document.queryCommandEnabled("createlink")}else e=this._browserQueryCommandEnabled("createlink");return e},_unlinkEnabledImpl:function(){return w("mozilla")||w("webkit")?this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){return!(!w("mozilla")&&!w("webkit"))||this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var e=!0;if(w("webkit")){var r=this.window.getSelection();r&&(r=r.toString()),e=!!r}else e=this._browserQueryCommandEnabled("cut");return e},_copyEnabledImpl:function(){var e=!0;if(w("webkit")){var r=this.window.getSelection();r&&(r=r.toString()),e=!!r}else e=this._browserQueryCommandEnabled("copy");return e},_pasteEnabledImpl:function(){return!!w("webkit")||this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(e){return w("ie")?this._inserthtmlImpl("<hr>"):this.document.execCommand("inserthorizontalrule",!1,e)},_unlinkImpl:function(e){if(this.queryCommandEnabled("unlink")&&(w("mozilla")||w("webkit"))){var r=this.selection.getAncestorElement("a");return this.selection.selectElement(r),this.document.execCommand("unlink",!1,null)}return this.document.execCommand("unlink",!1,e)},_hilitecolorImpl:function(e){var r;return this._handleTextColorOrProperties("hilitecolor",e)||(w("mozilla")?(this.document.execCommand("styleWithCSS",!1,!0),r=this.document.execCommand("hilitecolor",!1,e),this.document.execCommand("styleWithCSS",!1,!1)):r=this.document.execCommand("hilitecolor",!1,e)),r},_backcolorImpl:function(e){w("ie")&&(e=e||null);var r=this._handleTextColorOrProperties("backcolor",e);return r||(r=this.document.execCommand("backcolor",!1,e)),r},_forecolorImpl:function(e){w("ie")&&(e=e||null);var r=!1;return r=this._handleTextColorOrProperties("forecolor",e),r||(r=this.document.execCommand("forecolor",!1,e)),r},_inserthtmlImpl:function(e){e=this._preFilterContent(e);var r=!0;if(w("ie")<9){var t=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var a=t.item(0);t.length;)t.remove(t.item(0));a.outerHTML=e}else t.pasteHTML(e);t.select()}else if(w("trident")<8){var t,i=j.getSelection(this.window);if(i&&i.rangeCount&&i.getRangeAt){t=i.getRangeAt(0),t.deleteContents();var d=o.create("div");d.innerHTML=e;for(var l,n,a=this.document.createDocumentFragment();l=d.firstChild;)n=a.appendChild(l);t.insertNode(a),n&&(t=t.cloneRange(),t.setStartAfter(n),t.collapse(!1),i.removeAllRanges(),i.addRange(t))}}else w("mozilla")&&!e.length?this.selection.remove():r=this.document.execCommand("inserthtml",!1,e);return r},_boldImpl:function(e){var r=!1;return(w("ie")||w("trident"))&&(this._adaptIESelection(),r=this._adaptIEFormatAreaAndExec("bold")),r||(r=this.document.execCommand("bold",!1,e)),r},_italicImpl:function(e){var r=!1;return(w("ie")||w("trident"))&&(this._adaptIESelection(),r=this._adaptIEFormatAreaAndExec("italic")),r||(r=this.document.execCommand("italic",!1,e)),r},_underlineImpl:function(e){var r=!1;return(w("ie")||w("trident"))&&(this._adaptIESelection(),r=this._adaptIEFormatAreaAndExec("underline")),r||(r=this.document.execCommand("underline",!1,e)),r},_strikethroughImpl:function(e){var r=!1;return(w("ie")||w("trident"))&&(this._adaptIESelection(),r=this._adaptIEFormatAreaAndExec("strikethrough")),r||(r=this.document.execCommand("strikethrough",!1,e)),r},_superscriptImpl:function(e){var r=!1;return(w("ie")||w("trident"))&&(this._adaptIESelection(),r=this._adaptIEFormatAreaAndExec("superscript")),r||(r=this.document.execCommand("superscript",!1,e)),r},_subscriptImpl:function(e){var r=!1;return(w("ie")||w("trident"))&&(this._adaptIESelection(),r=this._adaptIEFormatAreaAndExec("subscript")),r||(r=this.document.execCommand("subscript",!1,e)),r},_fontnameImpl:function(e){var r;return(w("ie")||w("trident"))&&(r=this._handleTextColorOrProperties("fontname",e)),r||(r=this.document.execCommand("fontname",!1,e)),r},_fontsizeImpl:function(e){var r;return(w("ie")||w("trident"))&&(r=this._handleTextColorOrProperties("fontsize",e)),r||(r=this.document.execCommand("fontsize",!1,e)),r},_insertorderedlistImpl:function(e){var r=!1;return(w("ie")||w("trident")||w("edge"))&&(r=this._adaptIEList("insertorderedlist",e)),r||(r=this.document.execCommand("insertorderedlist",!1,e)),r},_insertunorderedlistImpl:function(e){var r=!1;return(w("ie")||w("trident")||w("edge"))&&(r=this._adaptIEList("insertunorderedlist",e)),r||(r=this.document.execCommand("insertunorderedlist",!1,e)),r},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(e){var r=0;if(e&&e.childNodes){var t;for(t=0;t<e.childNodes.length;t++){r+=n.position(e.childNodes[t]).h}}return r},_isNodeEmpty:function(e,r){return 1===e.nodeType?!(e.childNodes.length>0)||this._isNodeEmpty(e.childNodes[0],r):3===e.nodeType&&""===e.nodeValue.substring(r)},_removeStartingRangeFromRange:function(e,r){if(e.nextSibling)r.setStart(e.nextSibling,0);else{for(var t=e.parentNode;t&&null==t.nextSibling;)t=t.parentNode;t&&r.setStart(t.nextSibling,0)}return r},_adaptIESelection:function(){var e=j.getSelection(this.window);if(e&&e.rangeCount&&!e.isCollapsed){for(var r=e.getRangeAt(0),t=r.startContainer,a=r.startOffset;3===t.nodeType&&a>=t.length&&t.nextSibling;)a-=t.length,t=t.nextSibling;for(var i=null;this._isNodeEmpty(t,a)&&t!==i;)i=t,r=this._removeStartingRangeFromRange(t,r),t=r.startContainer,a=0;e.removeAllRanges(),e.addRange(r)}},_adaptIEFormatAreaAndExec:function(r){var t,a,i,d,l,n,s,f,m=j.getSelection(this.window),u=this.document;if(!(r&&m&&m.isCollapsed))return!1;if(this.queryCommandValue(r)){var v=this._tagNamesForCommand(r);i=m.getRangeAt(0);var h=i.startContainer;if(3===h.nodeType){var y=i.endOffset;h.length<y&&(a=this._adjustNodeAndOffset(t,y),h=a.node,y=a.offset)}for(var w;h&&h!==this.editNode;){var c=h.tagName?h.tagName.toLowerCase():"";if(e.indexOf(v,c)>-1){w=h;break}h=h.parentNode}if(w){t=i.startContainer;var M=u.createElement(w.tagName);if(o.place(M,w,"after"),t&&3===t.nodeType){var p,g,k=i.endOffset;t.length<k&&(a=this._adjustNodeAndOffset(t,k),t=a.node,k=a.offset),d=t.nodeValue,l=u.createTextNode(d.substring(0,k));var b=d.substring(k,d.length);b&&(n=u.createTextNode(b)),o.place(l,t,"before"),n&&(s=u.createElement("span"),s.className="ieFormatBreakerSpan",o.place(s,t,"after"),o.place(n,s,"after"),n=s),o.destroy(t);for(var F,I=l.parentNode,z=[];I!==w;){var A=I.tagName;F={tagName:A},z.push(F);var E=u.createElement(A);if(I.style&&E.style&&I.style.cssText&&(E.style.cssText=I.style.cssText,F.cssText=I.style.cssText),"FONT"===I.tagName&&(I.color&&(E.color=I.color,F.color=I.color),I.face&&(E.face=I.face,F.face=I.face),I.size&&(E.size=I.size,F.size=I.size)),I.className&&(E.className=I.className,F.className=I.className),n)for(p=n;p;)g=p.nextSibling,E.appendChild(p),p=g;E.tagName==I.tagName?(s=u.createElement("span"),s.className="ieFormatBreakerSpan",o.place(s,I,"after"),o.place(E,s,"after")):o.place(E,I,"after"),l=I,n=E,I=I.parentNode}if(n)for(p=n,(1===p.nodeType||3===p.nodeType&&p.nodeValue)&&(M.innerHTML="");p;)g=p.nextSibling,M.appendChild(p),p=g;var q;if(z.length){F=z.pop();var G=u.createElement(F.tagName);for(F.cssText&&G.style&&(G.style.cssText=F.cssText),F.className&&(G.className=F.className),"FONT"===F.tagName&&(F.color&&(G.color=F.color),F.face&&(G.face=F.face),F.size&&(G.size=F.size)),o.place(G,M,"before");z.length;){F=z.pop();var _=u.createElement(F.tagName);F.cssText&&_.style&&(_.style.cssText=F.cssText),F.className&&(_.className=F.className),"FONT"===F.tagName&&(F.color&&(_.color=F.color),F.face&&(_.face=F.face),F.size&&(_.size=F.size)),G.appendChild(_),G=_}f=u.createTextNode("."),s.appendChild(f),G.appendChild(f),q=j.create(this.window),q.setStart(f,0),q.setEnd(f,f.length),m.removeAllRanges(),m.addRange(q),this.selection.collapse(!1),f.parentNode.innerHTML=""}else s=u.createElement("span"),s.className="ieFormatBreakerSpan",f=u.createTextNode("."),s.appendChild(f),o.place(s,M,"before"),q=j.create(this.window),q.setStart(f,0),q.setEnd(f,f.length),m.removeAllRanges(),m.addRange(q),this.selection.collapse(!1),f.parentNode.innerHTML="";return M.firstChild||o.destroy(M),!0}}return!1}if(i=m.getRangeAt(0),(t=i.startContainer)&&3===t.nodeType){var y=i.startOffset;t.length<y&&(a=this._adjustNodeAndOffset(t,y),t=a.node,y=a.offset),d=t.nodeValue,l=u.createTextNode(d.substring(0,y));var b=d.substring(y);""!==b&&(n=u.createTextNode(d.substring(y))),s=u.createElement("span"),f=u.createTextNode("."),s.appendChild(f),l.length?o.place(l,t,"after"):l=t,o.place(s,l,"after"),n&&o.place(n,s,"after"),o.destroy(t);var q=j.create(this.window);return q.setStart(f,0),q.setEnd(f,f.length),m.removeAllRanges(),m.addRange(q),u.execCommand(r),o.place(s.firstChild,s,"before"),o.destroy(s),q.setStart(f,0),q.setEnd(f,f.length),m.removeAllRanges(),m.addRange(q),this.selection.collapse(!1),f.parentNode.innerHTML="",!0}},_adaptIEList:function(e){var r=j.getSelection(this.window);if(r.isCollapsed&&r.rangeCount&&!this.queryCommandValue(e)){var t=r.getRangeAt(0),a=t.startContainer;if(a&&3==a.nodeType&&!t.startOffset){var i="ul";"insertorderedlist"===e&&(i="ol");var d=this.document.createElement(i),l=o.create("li",null,d);o.place(d,a,"before"),l.appendChild(a),o.create("br",null,d,"after");var n=j.create(this.window);return n.setStart(a,0),n.setEnd(a,a.length),r.removeAllRanges(),r.addRange(n),this.selection.collapse(!0),!0}}return!1},_handleTextColorOrProperties:function(e,r){var t,a,i,d,l,n,f,m,u=j.getSelection(this.window),v=this.document;if(r=r||null,e&&u&&u.isCollapsed&&u.rangeCount&&(i=u.getRangeAt(0),(t=i.startContainer)&&3===t.nodeType)){var h=i.startOffset;t.length<h&&(a=this._adjustNodeAndOffset(t,h),t=a.node,h=a.offset),d=t.nodeValue,l=v.createTextNode(d.substring(0,h));""!==d.substring(h)&&(n=v.createTextNode(d.substring(h))),f=v.createElement("span"),m=v.createTextNode("."),f.appendChild(m);var y=v.createElement("span");f.appendChild(y),l.length?o.place(l,t,"after"):l=t,o.place(f,l,"after"),n&&o.place(n,f,"after"),o.destroy(t);var c=j.create(this.window);if(c.setStart(m,0),c.setEnd(m,m.length),u.removeAllRanges(),u.addRange(c),w("webkit")){var M="color";"hilitecolor"!==e&&"backcolor"!==e||(M="backgroundColor"),s.set(f,M,r),this.selection.remove(),o.destroy(y),f.innerHTML="&#160;",this.selection.selectElement(f),this.focus()}else this.execCommand(e,r),o.place(f.firstChild,f,"before"),o.destroy(f),c.setStart(m,0),c.setEnd(m,m.length),u.removeAllRanges(),u.addRange(c),this.selection.collapse(!1),m.parentNode.removeChild(m);return!0}return!1},_adjustNodeAndOffset:function(e,r){for(;e.length<r&&e.nextSibling&&3===e.nextSibling.nodeType;)r-=e.length,e=e.nextSibling;return{node:e,offset:r}},_tagNamesForCommand:function(e){return"bold"===e?["b","strong"]:"italic"===e?["i","em"]:"strikethrough"===e?["s","strike"]:"superscript"===e?["sup"]:"subscript"===e?["sub"]:"underline"===e?["u"]:[]},_stripBreakerNodes:function(e){if(this.isLoaded)return h(".ieFormatBreakerSpan",e).forEach(function(e){for(;e.firstChild;)o.place(e.firstChild,e,"before");o.destroy(e)}),e},_stripTrailingEmptyNodes:function(e){function r(e){return/^(p|div|br)$/i.test(e.nodeName)&&0==e.children.length&&/^[\s\xA0]*$/.test(e.textContent||e.innerText||"")||3===e.nodeType&&/^[\s\xA0]*$/.test(e.nodeValue)}for(;e.lastChild&&r(e.lastChild);)o.destroy(e.lastChild);return e},_setTextDirAttr:function(e){this._set("textDir",e),this.onLoadDeferred.then(u.hitch(this,function(){this.editNode.dir=e}))}});return q});//# sourceMappingURL=RichText.js.map