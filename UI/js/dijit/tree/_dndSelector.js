//>>built
define("dijit/tree/_dndSelector",["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/dnd/common","dojo/dom","dojo/mouse","dojo/on","dojo/touch","../a11yclick","./_dndContainer"],function(e,t,r,a,i,d,l,o,n,s,f){return t("dijit.tree._dndSelector",f,{constructor:function(){this.selection={},this.anchor=null,this.events.push(o(this.tree.domNode,n.press,a.hitch(this,"onMouseDown")),o(this.tree.domNode,n.release,a.hitch(this,"onMouseUp")),o(this.tree.domNode,n.move,a.hitch(this,"onMouseMove")),o(this.tree.domNode,s.press,a.hitch(this,"onClickPress")),o(this.tree.domNode,s.release,a.hitch(this,"onClickRelease")))},singular:!1,getSelectedTreeNodes:function(){var e=[],t=this.selection;for(var r in t)e.push(t[r]);return e},selectNone:function(){return this.setSelection([]),this},destroy:function(){this.inherited(arguments),this.selection=this.anchor=null},addTreeNode:function(e,t){return this.setSelection(this.getSelectedTreeNodes().concat([e])),t&&(this.anchor=e),e},removeTreeNode:function(t){var r=e.filter(this.getSelectedTreeNodes(),function(e){return!d.isDescendant(e.domNode,t.domNode)});return this.setSelection(r),t},isTreeNodeSelected:function(e){return e.id&&!!this.selection[e.id]},setSelection:function(t){var r=this.getSelectedTreeNodes();e.forEach(this._setDifference(r,t),a.hitch(this,function(e){e.setSelected(!1),this.anchor==e&&delete this.anchor,delete this.selection[e.id]})),e.forEach(this._setDifference(t,r),a.hitch(this,function(e){e.setSelected(!0),this.selection[e.id]=e})),this._updateSelectionProperties()},_setDifference:function(t,r){e.forEach(r,function(e){e.__exclude__=!0});var a=e.filter(t,function(e){return!e.__exclude__});return e.forEach(r,function(e){delete e.__exclude__}),a},_updateSelectionProperties:function(){var t=this.getSelectedTreeNodes(),r=[],a=[];e.forEach(t,function(e){var t=e.getTreePath();a.push(e),r.push(t)},this);var i=e.map(a,function(e){return e.item});this.tree._set("paths",r),this.tree._set("path",r[0]||[]),this.tree._set("selectedNodes",a),this.tree._set("selectedNode",a[0]||null),this.tree._set("selectedItems",i),this.tree._set("selectedItem",i[0]||null)},onClickPress:function(e){if(!(this.current&&this.current.isExpandable&&this.tree.isExpandoNode(e.target,this.current))){"mousedown"==e.type&&l.isLeft(e)&&e.preventDefault();var t="keydown"==e.type?this.tree.focusedChild:this.current;if(t){var r=i.getCopyKeyState(e),a=t.id;if(!this.singular&&!e.shiftKey&&this.selection[a])return void(this._doDeselect=!0);this._doDeselect=!1,this.userSelect(t,r,e.shiftKey)}}},onClickRelease:function(e){this._doDeselect&&(this._doDeselect=!1,this.userSelect("keyup"==e.type?this.tree.focusedChild:this.current,i.getCopyKeyState(e),e.shiftKey))},onMouseMove:function(){this._doDeselect=!1},onMouseDown:function(){},onMouseUp:function(){},_compareNodes:function(e,t){if(e===t)return 0;if("sourceIndex"in document.documentElement)return e.sourceIndex-t.sourceIndex;if("compareDocumentPosition"in document.documentElement)return 2&e.compareDocumentPosition(t)?1:-1;if(document.createRange){var r=doc.createRange();r.setStartBefore(e);var a=doc.createRange();return a.setStartBefore(t),r.compareBoundaryPoints(r.END_TO_END,a)}throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser")},userSelect:function(e,t,r){if(this.singular)this.anchor==e&&t?this.selectNone():(this.setSelection([e]),this.anchor=e);else if(r&&this.anchor){var a,i,d=this._compareNodes(this.anchor.rowNode,e.rowNode),l=this.anchor;d<0?(a=l,i=e):(a=e,i=l);for(var o=[];a!=i;)o.push(a),a=this.tree._getNext(a);o.push(i),this.setSelection(o)}else this.selection[e.id]&&t?this.removeTreeNode(e):t?this.addTreeNode(e,!0):(this.setSelection([e]),this.anchor=e)},getItem:function(e){return{data:this.selection[e],type:["treeNode"]}},forInSelectedItems:function(e,t){t=t||r.global;for(var a in this.selection)e.call(t,this.getItem(a),a,this)}})});//# sourceMappingURL=_dndSelector.js.map