//>>built
define("dijit/tree/TreeStoreModel",["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang"],function(e,t,r,a){return r("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:!1,constructor:function(e){a.mixin(this,e),this.connects=[];var r=this.store;if(!r.getFeatures()["dojo.data.api.Identity"])throw new Error("dijit.tree.TreeStoreModel: store must support dojo.data.Identity");r.getFeatures()["dojo.data.api.Notification"]&&(this.connects=this.connects.concat([t.after(r,"onNew",a.hitch(this,"onNewItem"),!0),t.after(r,"onDelete",a.hitch(this,"onDeleteItem"),!0),t.after(r,"onSet",a.hitch(this,"onSetItem"),!0)]))},destroy:function(){for(var e;e=this.connects.pop();)e.remove()},getRoot:function(e,t){this.root?e(this.root):this.store.fetch({query:this.query,onComplete:a.hitch(this,function(t){if(1!=t.length)throw new Error("dijit.tree.TreeStoreModel: root query returned "+t.length+" items, but must return exactly one");this.root=t[0],e(this.root)}),onError:t})},mayHaveChildren:function(t){return e.some(this.childrenAttrs,function(e){return this.store.hasAttribute(t,e)},this)},getChildren:function(t,r,i){var d=this.store;if(!d.isItemLoaded(t)){var l=a.hitch(this,arguments.callee);return void d.loadItem({item:t,onItem:function(e){l(e,r,i)},onError:i})}for(var o=[],n=0;n<this.childrenAttrs.length;n++){var s=d.getValues(t,this.childrenAttrs[n]);o=o.concat(s)}var f=0;this.deferItemLoadingUntilExpand||e.forEach(o,function(e){d.isItemLoaded(e)||f++}),0==f?r(o):e.forEach(o,function(e,t){d.isItemLoaded(e)||d.loadItem({item:e,onItem:function(e){o[t]=e,0==--f&&r(o)},onError:i})})},isItem:function(e){return this.store.isItem(e)},fetchItemByIdentity:function(e){this.store.fetchItemByIdentity(e)},getIdentity:function(e){return this.store.getIdentity(e)},getLabel:function(e){return this.labelAttr?this.store.getValue(e,this.labelAttr):this.store.getLabel(e)},newItem:function(e,t,r){var a,i={parent:t,attribute:this.childrenAttrs[0]};this.newItemIdAttr&&e[this.newItemIdAttr]?this.fetchItemByIdentity({identity:e[this.newItemIdAttr],scope:this,onItem:function(d){d?this.pasteItem(d,null,t,!0,r):(a=this.store.newItem(e,i))&&void 0!=r&&this.pasteItem(a,t,t,!1,r)}}):(a=this.store.newItem(e,i))&&void 0!=r&&this.pasteItem(a,t,t,!1,r)},pasteItem:function(t,r,a,i,d){var l=this.store,o=this.childrenAttrs[0];if(r&&e.forEach(this.childrenAttrs,function(a){if(l.containsValue(r,a,t)){if(!i){var d=e.filter(l.getValues(r,a),function(e){return e!=t});l.setValues(r,a,d)}o=a}}),a)if("number"==typeof d){var n=l.getValues(a,o).slice();n.splice(d,0,t),l.setValues(a,o,n)}else l.setValues(a,o,l.getValues(a,o).concat(t))},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onNewItem:function(e,t){t&&this.getChildren(t.item,a.hitch(this,function(e){this.onChildrenChange(t.item,e)}))},onDeleteItem:function(e){this.onDelete(e)},onSetItem:function(t,r){-1!=e.indexOf(this.childrenAttrs,r)?this.getChildren(t,a.hitch(this,function(e){this.onChildrenChange(t,e)})):this.onChange(t)}})});//# sourceMappingURL=TreeStoreModel.js.map