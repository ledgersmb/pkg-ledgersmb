//>>built
define("dijit/_HasDropDown",["dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","dojo/touch","./registry","./focus","./popup","./_FocusMixin"],function(e,r,t,a,i,d,l,o,n,s,f,m,v,u,h,y){return e("dijit._HasDropDown",y,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(e){this.disabled||this.readOnly||("MSPointerDown"!=e.type&&e.preventDefault(),this.own(f.once(this.ownerDocument,m.release,s.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(e){var r=this.dropDown,t=!1;if(e&&this._opened){var a=d.position(this._buttonNode,!0);if(!(e.pageX>=a.x&&e.pageX<=a.x+a.w&&e.pageY>=a.y&&e.pageY<=a.y+a.h)){for(var l=e.target;l&&!t;)i.contains(l,"dijitPopup")?t=!0:l=l.parentNode;if(t){if(l=e.target,r.onItemClick){for(var o;l&&!(o=v.byNode(l));)l=l.parentNode;o&&o.onClick&&o.getParent&&o.getParent().onItemClick(o,e)}return}}}this._opened?r.focus&&(!1!==r.autoFocus||"mouseup"==e.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){r.focus(),delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(e){this._stopClickEvents&&(e.stopPropagation(),e.preventDefault())},buildRendering:function(){this.inherited(arguments),this._buttonNode=this._buttonNode||this.focusNode||this.domNode,this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var e={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";i.add(this._arrowWrapperNode||this._buttonNode,"dijit"+e+"ArrowButton")},postCreate:function(){this.inherited(arguments);var e=this.focusNode||this.domNode;this.own(f(this._buttonNode,m.press,s.hitch(this,"_onDropDownMouseDown")),f(this._buttonNode,"click",s.hitch(this,"_onDropDownClick")),f(e,"keydown",s.hitch(this,"_onKey")),f(e,"keyup",s.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0),this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown),this.inherited(arguments)},_onKey:function(e){if(!this.disabled&&!this.readOnly){var r=this.dropDown,t=e.target;if(r&&this._opened&&r.handleKey&&!1===r.handleKey(e))return e.stopPropagation(),void e.preventDefault();r&&this._opened&&e.keyCode==n.ESCAPE?(this.closeDropDown(),e.stopPropagation(),e.preventDefault()):!this._opened&&(e.keyCode==n.DOWN_ARROW||(e.keyCode==n.ENTER||e.keyCode==n.SPACE&&(!this._searchTimer||e.ctrlKey||e.altKey||e.metaKey))&&("input"!==(t.tagName||"").toLowerCase()||t.type&&"text"!==t.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,e.stopPropagation(),e.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp,this.toggleDropDown();var e=this.dropDown;e&&e.focus&&this.defer(s.hitch(e,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1),this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(e){e()},loadAndOpenDropDown:function(){var e=new r,t=s.hitch(this,function(){this.openDropDown(),e.resolve(this.dropDown)});return this.isLoaded()?t():this.loadDropDown(t),e},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var e=this.dropDown,r=e.domNode,t=this._aroundNode||this.domNode,l=this,o=h.open({parent:this,popup:e,around:t,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){l.closeDropDown(!0)},onCancel:function(){l.closeDropDown(!0)},onClose:function(){a.set(l._popupStateNode,"popupActive",!1),i.remove(l._popupStateNode,"dijitHasDropDownOpen"),l._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&t.offsetWidth>e._popupWrapper.offsetWidth){var n=t.offsetWidth-e._popupWrapper.offsetWidth,f={w:e.domNode.offsetWidth+n};this._origStyle=r.style.cssText,s.isFunction(e.resize)?e.resize(f):d.setMarginBox(r,f),"R"==o.corner[1]&&(e._popupWrapper.style.left=e._popupWrapper.style.left.replace("px","")-n+"px")}return a.set(this._popupStateNode,"popupActive","true"),i.add(this._popupStateNode,"dijitHasDropDownOpen"),this._set("_opened",!0),this._popupStateNode.setAttribute("aria-expanded","true"),this._popupStateNode.setAttribute("aria-owns",e.id),"presentation"===r.getAttribute("role")||r.getAttribute("aria-labelledby")||r.setAttribute("aria-labelledby",this.id),o},closeDropDown:function(e){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer),this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),e&&this.focus&&this.focus(),h.close(this.dropDown),this._opened=!1),this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})});//# sourceMappingURL=_HasDropDown.js.map