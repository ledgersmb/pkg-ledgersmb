//>>built
define("dijit/selection",["dojo/_base/array","dojo/dom","dojo/_base/lang","dojo/sniff","dojo/_base/window","dijit/focus"],function(e,r,t,a,i,d){var l=function(l){var o=l.document;this.getType=function(){if(o.getSelection){var e,r="text";try{e=l.getSelection()}catch(e){}if(e&&1==e.rangeCount){var t=e.getRangeAt(0);t.startContainer==t.endContainer&&t.endOffset-t.startOffset==1&&3!=t.startContainer.nodeType&&(r="control")}return r}return o.selection.type.toLowerCase()},this.getSelectedText=function(){if(o.getSelection){var e=l.getSelection();return e?e.toString():""}return"control"==this.getType()?null:o.selection.createRange().text},this.getSelectedHtml=function(){if(o.getSelection){var e=l.getSelection();if(e&&e.rangeCount){var r,t="";for(r=0;r<e.rangeCount;r++){var a=e.getRangeAt(r).cloneContents(),i=o.createElement("div");i.appendChild(a),t+=i.innerHTML}return t}return null}return"control"==this.getType()?null:o.selection.createRange().htmlText},this.getSelectedElement=function(){if("control"==this.getType()){if(o.getSelection){var e=l.getSelection();return e.anchorNode.childNodes[e.anchorOffset]}var r=o.selection.createRange();if(r&&r.item)return o.selection.createRange().item(0)}return null},this.getParentElement=function(){if("control"==this.getType()){var e=this.getSelectedElement();if(e)return e.parentNode}else{if(!o.getSelection){var r=o.selection.createRange();return r.collapse(!0),r.parentElement()}var t=o.getSelection();if(t){for(var a=t.anchorNode;a&&1!=a.nodeType;)a=a.parentNode;return a}}return null},this.hasAncestorElement=function(e){return null!=this.getAncestorElement.apply(this,arguments)},this.getAncestorElement=function(e){var r=this.getSelectedElement()||this.getParentElement();return this.getParentOfType(r,arguments)},this.isTag=function(e,r){if(e&&e.tagName)for(var t=e.tagName.toLowerCase(),a=0;a<r.length;a++){var i=String(r[a]).toLowerCase();if(t==i)return i}return""},this.getParentOfType=function(e,r){for(;e;){if(this.isTag(e,r).length)return e;e=e.parentNode}return null},this.collapse=function(e){if(o.getSelection){var r=l.getSelection();r.removeAllRanges?e?r.collapseToStart():r.collapseToEnd():r.collapse(e)}else{var t=o.selection.createRange();t.collapse(e),t.select()}},this.remove=function(){var e=o.selection;return o.getSelection?(e=l.getSelection(),e.deleteFromDocument(),e):("none"!=e.type.toLowerCase()&&e.clear(),e)},this.selectElementChildren=function(e,t){var i;if(e=r.byId(e),o.getSelection){var d=l.getSelection();a("opera")?(i=d.rangeCount?d.getRangeAt(0):o.createRange(),i.setStart(e,0),i.setEnd(e,3==e.nodeType?e.length:e.childNodes.length),d.addRange(i)):d.selectAllChildren(e)}else if(i=e.ownerDocument.body.createTextRange(),i.moveToElementText(e),!t)try{i.select()}catch(e){}},this.selectElement=function(e,t){var d;if(e=r.byId(e),o.getSelection){var l=o.getSelection();d=o.createRange(),l.removeAllRanges&&(a("opera")&&l.getRangeAt(0)&&(d=l.getRangeAt(0)),d.selectNode(e),l.removeAllRanges(),l.addRange(d))}else try{var n=e.tagName?e.tagName.toLowerCase():"";d="img"===n||"table"===n?i.body(o).createControlRange():i.body(o).createRange(),d.addElement(e),t||d.select()}catch(r){this.selectElementChildren(e,t)}},this.inSelection=function(e){if(e){var r,t;if(o.getSelection){var a=l.getSelection();if(a&&a.rangeCount>0&&(t=a.getRangeAt(0)),t&&t.compareBoundaryPoints&&o.createRange)try{if(r=o.createRange(),r.setStart(e,0),1===t.compareBoundaryPoints(t.START_TO_END,r))return!0}catch(e){}}else{t=o.selection.createRange();try{r=e.ownerDocument.body.createTextRange(),r.moveToElementText(e)}catch(e){}if(t&&r&&1===t.compareEndPoints("EndToStart",r))return!0}}return!1},this.getBookmark=function(){var e,r,t,a=o.selection,i=d.curNode;if(o.getSelection){if(a=l.getSelection())if(a.isCollapsed){if((t=i?i.tagName:"")&&("textarea"==(t=t.toLowerCase())||"input"==t&&(!i.type||"text"==i.type.toLowerCase())))return a={start:i.selectionStart,end:i.selectionEnd,node:i,pRange:!0},{isCollapsed:a.end<=a.start,mark:a};e={isCollapsed:!0},a.rangeCount&&(e.mark=a.getRangeAt(0).cloneRange())}else r=a.getRangeAt(0),e={isCollapsed:!1,mark:r.cloneRange()}}else if(a){if(t=i?i.tagName:"",t=t.toLowerCase(),i&&t&&("button"==t||"textarea"==t||"input"==t))return a.type&&"none"==a.type.toLowerCase()?{isCollapsed:!0,mark:null}:(r=a.createRange(),{isCollapsed:!r.text||!r.text.length,mark:{range:r,pRange:!0}});e={};try{r=a.createRange(),e.isCollapsed=!("Text"==a.type?r.htmlText.length:r.length)}catch(r){return e.isCollapsed=!0,e}if("CONTROL"==a.type.toUpperCase())if(r.length){e.mark=[];for(var n=0,s=r.length;n<s;)e.mark.push(r.item(n++))}else e.isCollapsed=!0,e.mark=null;else e.mark=r.getBookmark()}return e},this.moveToBookmark=function(r){var a=r.mark;if(a)if(o.getSelection){var i=l.getSelection();if(i&&i.removeAllRanges)if(a.pRange){var d=a.node;d.selectionStart=a.start,d.selectionEnd=a.end}else i.removeAllRanges(),i.addRange(a)}else if(o.selection&&a){var n;a.pRange?n=a.range:t.isArray(a)?(n=o.body.createControlRange(),e.forEach(a,function(e){n.addElement(e)})):(n=o.body.createTextRange(),n.moveToBookmark(a)),n.select()}},this.isCollapsed=function(){return this.getBookmark().isCollapsed}},o=new l(window);return o.SelectionManager=l,o});//# sourceMappingURL=selection.js.map