//>>built
define("dijit/popup",["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","./place","./BackgroundIframe","./Viewport","./main","dojo/touch"],function(e,r,t,a,i,d,l,o,n,s,f,m,v,u,h,y){function w(){this._popupWrapper&&(d.destroy(this._popupWrapper),delete this._popupWrapper)}var M=t(null,{_stack:[],_beginZIndex:1e3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var e=this._firstAroundPosition,r=l.position(this._firstAroundNode,!0),t=r.x-e.x,a=r.y-e.y;if(t||a){this._firstAroundPosition=r;for(var i=0;i<this._stack.length;i++){var d=this._stack[i].wrapper.style;d.top=parseFloat(d.top)+a+"px","auto"==d.right?d.left=parseFloat(d.left)+t+"px":d.right=parseFloat(d.right)-t+"px"}}this._aroundMoveListener=setTimeout(f.hitch(this,"_repositionAll"),t||a?10:50)}},_createWrapper:function(e){var t=e._popupWrapper,a=e.domNode;if(!t){t=d.create("div",{class:"dijitPopup",style:{display:"none"},role:"region","aria-label":e["aria-label"]||e.label||e.name||e.id},e.ownerDocumentBody),t.appendChild(a);var i=a.style;i.display="",i.visibility="",i.position="",i.top="0px",e._popupWrapper=t,r.after(e,"destroy",w,!0),"ontouchend"in document&&m(t,"touchend",function(e){/^(input|button|textarea)$/i.test(e.target.tagName)||e.preventDefault()}),t.dojoClick=!0}return t},moveOffScreen:function(e){var r=this._createWrapper(e),t=l.isBodyLtr(e.ownerDocument),a={visibility:"hidden",top:"-9999px",display:""};return a[t?"left":"right"]="-9999px",a[t?"right":"left"]="auto",o.set(r,a),r},hide:function(e){var r=this._createWrapper(e);o.set(r,{display:"none",height:"auto",overflowY:"visible",border:""});var t=e.domNode;"_originalStyle"in t&&(t.style.cssText=t._originalStyle)},getTopPopup:function(){for(var e=this._stack,r=e.length-1;r>0&&e[r].parent===e[r-1].widget;r--);return e[r]},open:function(e){for(var r=this._stack,t=e.popup,d=t.domNode,y=e.orient||["below","below-alt","above","above-alt"],w=e.parent?e.parent.isLeftToRight():l.isBodyLtr(t.ownerDocument),M=e.around,c=e.around&&e.around.id?e.around.id+"_dropdown":"popup_"+this._idGen++;r.length&&(!e.parent||!a.isDescendant(e.parent.domNode,r[r.length-1].widget.domNode));)this.close(r[r.length-1].widget);var p=this.moveOffScreen(t);t.startup&&!t._started&&t.startup();var g,k=l.position(d);if("maxHeight"in e&&-1!=e.maxHeight)g=e.maxHeight||1/0;else{var b=h.getEffectiveBox(this.ownerDocument),F=M?l.position(M,!1):{y:e.y-(e.padding||0),h:2*(e.padding||0)};g=Math.floor(Math.max(F.y,b.h-(F.y+F.h)))}if(k.h>g){var I=o.getComputedStyle(d),j=I.borderLeftWidth+" "+I.borderLeftStyle+" "+I.borderLeftColor;o.set(p,{overflowY:"scroll",height:g+"px",border:j}),d._originalStyle=d.style.cssText,d.style.border="none"}i.set(p,{id:c,style:{zIndex:this._beginZIndex+r.length},class:"dijitPopup "+(t.baseClass||t.class||"").split(" ")[0]+"Popup",dijitPopupParent:e.parent?e.parent.id:""}),0==r.length&&M&&(this._firstAroundNode=M,this._firstAroundPosition=l.position(M,!0),this._aroundMoveListener=setTimeout(f.hitch(this,"_repositionAll"),50)),n("config-bgIframe")&&!t.bgIframe&&(t.bgIframe=new u(p));var z=t.orient?f.hitch(t,"orient"):null,A=M?v.around(p,M,y,w,z):v.at(p,e,"R"==y?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],e.padding,z);p.style.visibility="visible",d.style.visibility="visible";var E=[];return E.push(m(p,"keydown",f.hitch(this,function(r){if(r.keyCode==s.ESCAPE&&e.onCancel)r.stopPropagation(),r.preventDefault(),e.onCancel();else if(r.keyCode==s.TAB){r.stopPropagation(),r.preventDefault();var t=this.getTopPopup();t&&t.onCancel&&t.onCancel()}}))),t.onCancel&&e.onCancel&&E.push(t.on("cancel",e.onCancel)),E.push(t.on(t.onExecute?"execute":"change",f.hitch(this,function(){var e=this.getTopPopup();e&&e.onExecute&&e.onExecute()}))),r.push({widget:t,wrapper:p,parent:e.parent,onExecute:e.onExecute,onCancel:e.onCancel,onClose:e.onClose,handlers:E}),t.onOpen&&t.onOpen(A),A},close:function(r){for(var t=this._stack;r&&e.some(t,function(e){return e.widget==r})||!r&&t.length;){var a=t.pop(),i=a.widget,d=a.onClose;i.bgIframe&&(i.bgIframe.destroy(),delete i.bgIframe),i.onClose&&i.onClose();for(var l;l=a.handlers.pop();)l.remove();i&&i.domNode&&this.hide(i),d&&d()}0==t.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=this._aroundMoveListener=null)}});return y.popup=new M});//# sourceMappingURL=popup.js.map