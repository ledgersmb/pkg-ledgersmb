//>>built
define("dijit/focus",["dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/lang","dojo/on","dojo/domReady","dojo/sniff","dojo/Stateful","dojo/_base/window","dojo/window","./a11y","./registry","./main"],function(e,r,t,a,i,d,l,o,n,s,f,m,v,u,h,y,w){var M,c,p=r([m,l],{curNode:null,activeStack:[],constructor:function(){var r=o.hitch(this,function(e){t.isDescendant(this.curNode,e)&&this.set("curNode",null),t.isDescendant(this.prevNode,e)&&this.set("prevNode",null)});e.before(d,"empty",r),e.before(d,"destroy",r)},registerIframe:function(e){return this.registerWin(e.contentWindow,e)},registerWin:function(e,r){var t=this,a=e.document&&e.document.body;if(a){var i=f("pointer-events")?"pointerdown":f("MSPointer")?"MSPointerDown":f("touch-events")?"mousedown, touchstart":"mousedown",d=n(e.document,i,function(e){e&&e.target&&null==e.target.parentNode||t._onTouchNode(r||e.target,"mouse")}),l=n(a,"focusin",function(e){if(e.target.tagName){var a=e.target.tagName.toLowerCase();"#document"!=a&&"body"!=a&&(h.isFocusable(e.target)?t._onFocusNode(r||e.target):t._onTouchNode(r||e.target))}}),o=n(a,"focusout",function(e){t._onBlurNode(r||e.target)});return{remove:function(){d.remove(),l.remove(),o.remove(),d=l=o=null,a=null}}}},_onBlurNode:function(e){var r=(new Date).getTime();r<M+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(o.hitch(this,function(){this.set("prevNode",this.curNode),this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),r<c+100||(this._clearActiveWidgetsTimer=setTimeout(o.hitch(this,function(){delete this._clearActiveWidgetsTimer,this._setStack([])}),0)))},_onTouchNode:function(e,r){c=(new Date).getTime(),this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer),i.contains(e,"dijitPopup")&&(e=e.firstChild);var t=[];try{for(;e;){var d=a.get(e,"dijitPopupParent");if(d)e=y.byId(d).domNode;else if(e.tagName&&"body"==e.tagName.toLowerCase()){if(e===v.body())break;e=u.get(e.ownerDocument).frameElement}else{var l=e.getAttribute&&e.getAttribute("widgetId"),o=l&&y.byId(l);!o||"mouse"==r&&o.get("disabled")||t.unshift(l),e=e.parentNode}}}catch(e){}this._setStack(t,r)},_onFocusNode:function(e){e&&9!=e.nodeType&&(M=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(e),e!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",e)))},_setStack:function(e,r){var t=this.activeStack,a=t.length-1,i=e.length-1;if(e[i]!=t[a]){this.set("activeStack",e);var d,l;for(l=a;l>=0&&t[l]!=e[l];l--)(d=y.byId(t[l]))&&(d._hasBeenBlurred=!0,d.set("focused",!1),d._focusManager==this&&d._onBlur(r),this.emit("widget-blur",d,r));for(l++;l<=i;l++)(d=y.byId(e[l]))&&(d.set("focused",!0),d._focusManager==this&&d._onFocus(r),this.emit("widget-focus",d,r))}},focus:function(e){if(e)try{e.focus()}catch(e){}}}),g=new p;s(function(){var e=g.registerWin(u.get(document));f("ie")&&n(window,"unload",function(){e&&(e.remove(),e=null)})}),w.focus=function(e){g.focus(e)};for(var k in g)/^_/.test(k)||(w.focus[k]="function"==typeof g[k]?o.hitch(g,k):g[k]);return g.watch(function(e,r,t){w.focus[e]=t}),g});//# sourceMappingURL=focus.js.map