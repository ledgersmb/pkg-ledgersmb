//>>built
define("lsmb/iframe",["module","require","dojo/request/watch","dojo/request/util","dojo/request/handlers","dojo/_base/lang","dojo/io-query","dojo/query","dojo/has","dojo/dom","dojo/dom-construct","dojo/cookie","dojo/_base/window","dojo/NodeList-manipulate","dojo/NodeList-dom"],function(e,t,r,a,i,d,l,o,n,s,f,m,u){function h(e,r,a){if(u.global[e])return u.global[e];if(u.global.frames[e])return u.global.frames[e];a||(n("config-useXDomain")&&n("config-dojoBlankHtmlUrl"),a=n("config-dojoBlankHtmlUrl")||t.toUrl("dojo/resources/blank.html"));var i=f.place('<iframe id="'+e+'" name="'+e+'" src="'+a+'" onload="'+r+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',u.body());return u.global[e]=i,i}function v(e,t,r){var a=u.global.frames[e.name];a.contentWindow&&(a=a.contentWindow);try{r?a.location.replace(t):a.location=t}catch(e){}}function y(e){if(e.contentDocument)return e.contentDocument;var t=e.name;if(t){var r=u.doc.getElementsByTagName("iframe");if(e.document&&r[t].contentWindow&&r[t].contentWindow.document)return r[t].contentWindow.document;if(u.doc.frames[t]&&u.doc.frames[t].document)return u.doc.frames[t].document}return null}function c(){return f.create("form",{name:F+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},u.body())}function w(){var e;try{if(k._currentDfd||!k._dfdQueue.length)return;do{e=k._currentDfd=k._dfdQueue.shift()}while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&k._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled())return void(k._currentDfd=null);var t,r=e.response,i=r.options,n=e._contentToClean=[],h=s.byId(i.form),v=a.notify,y=i.data||null;if(y["request.download-cookie"]=j,m(j,"requested"),e._legacy||"POST"!==i.method||h?"GET"===i.method&&h&&r.url.indexOf("?")>-1&&(t=r.url.slice(r.url.indexOf("?")+1),y=d.mixin(l.queryToObject(t),y)):h=e._tmpForm=c(),h){if(!e._legacy){var w=h;do{w=w.parentNode}while(w&&w!==u.doc.documentElement);w||(h.style.position="absolute",h.style.left="-1000px",h.style.top="-1000px",u.body().appendChild(h)),h.name||(h.name=F+"_form")}if(y){var M=function(e,t){f.create("input",{type:"hidden",name:e,value:t},h),n.push(e)};for(var p in y){var g=y[p];if(d.isArray(g)&&g.length>1)for(var b=0;b<g.length;b++)M(p,g[b]);else{var I=o("input[name='"+p+"']",h);-1==I.indexOf()?M(p,g):I.val(g)}}}var z=h.getAttributeNode("action"),A=h.getAttributeNode("method"),_=h.getAttributeNode("target");r.url&&(e._originalAction=z?z.value:null,z?z.value=r.url:h.setAttribute("action",r.url)),e._legacy?A&&A.value||(A?A.value=i.method:h.setAttribute("method",i.method)):(e._originalMethod=A?A.value:null,A?A.value=i.method:h.setAttribute("method",i.method)),e._originalTarget=_?_.value:null,_?_.value=k._iframeName:h.setAttribute("target",k._iframeName),h.target=k._iframeName,v&&v.emit("send",r,e.promise.cancel),k._notifyStart(r),h.submit()}else{var E="";r.options.data&&"string"!=typeof(E=r.options.data)&&(E=l.objectToQuery(E));var q=r.url+(r.url.indexOf("?")>-1?"&":"?")+E;v&&v.emit("send",r,e.promise.cancel),k._notifyStart(r),k.setSrc(k._frame,q,!0)}}catch(t){e.reject(t)}}function M(e){return!this.isFulfilled()}function p(e){return!!this._finished||"requested"!==m(j)}function g(e,t){var r=e.options,a=s.byId(r.form)||this._tmpForm;if(a){for(var l=this._contentToClean,n=0;n<l.length;n++)for(var u=l[n],h=0;h<a.childNodes.length;h++){var v=a.childNodes[h];if(v.name===u){f.destroy(v);break}}this._originalAction&&a.setAttribute("action",this._originalAction),this._originalMethod&&(a.setAttribute("method",this._originalMethod),a.method=this._originalMethod),this._originalTarget&&(a.setAttribute("target",this._originalTarget),a.target=this._originalTarget)}if(this._tmpForm&&(f.destroy(this._tmpForm),delete this._tmpForm),!t&&"requested"===m(j))try{var y=k.doc(k._frame),c=r.handleAs;if("html"!==c){if("xml"===c)if("html"===y.documentElement.tagName.toLowerCase()){o("a",y.documentElement).orphan();var w=y.documentElement.innerText||y.documentElement.textContent;w=w.replace(/>\s+</g,"><"),e.text=d.trim(w)}else e.data=y;else e.text=y.getElementsByTagName("textarea")[0].value;i(e)}else e.data=y}catch(e){t=e}t?this.reject(t):this._finished||"requested"!==m(j)?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function b(e){this._callNext()}function k(e,t,i){var d=a.parseArgs(e,a.deepCreate(z,t),!0);if(e=d.url,t=d.options,"GET"!==t.method&&"POST"!==t.method)throw new Error(t.method+" not supported by dojo/request/iframe");k._frame||(k._frame=k.create(k._iframeName,I+"();"));var l=a.deferred(d,null,M,p,g,b);return l._callNext=function(){this._calledNext||(this._calledNext=!0,k._currentDfd=null,k._fireNextRequest())},l._legacy=i,k._dfdQueue.push(l),k._fireNextRequest(),r(l),i?l:l.promise}var F=e.id.replace(/[\/\.\-]/g,"_"),I=F+"_onload",j="request-download."+(new Date).getTime();u.global[I]||(u.global[I]=function(){var e=k._currentDfd;if(!e)return void k._fireNextRequest();e._finished=!0});var z={method:"POST"};return k.create=h,k.doc=y,k.setSrc=v,k._iframeName=F+"_IoIframe",k._notifyStart=function(){},k._dfdQueue=[],k._currentDfd=null,k._fireNextRequest=w,a.addCommonMethods(k,["GET","POST"]),k});//# sourceMappingURL=iframe.js.map