%<?lsmb FILTER latex ?>
%
%<?lsmb
  max_path_depth = 0;
  FOREACH row IN report.sorted_row_ids ;
     IF max_path_depth < report.rheads.ids.$row.path.size ;
        max_path_depth = report.rheads.ids.$row.path.size ;
     END;
  END;
  last_col_no = max_path_depth + 1 + report.cheads.ids.keys.size;

 -?>

\documentclass[12pt]{article}
\usepackage{longtable}
\begin{document}
\renewcommand\baselinestretch{1.2}\selectfont
\begin{center}
\Huge{<?lsmb text('Income Statement') ?>}
\end{center}


\begin{longtable}{@{\extracolsep{10pt}}<?lsmb i = 1; WHILE i <= max_path_depth ; 'l'; i = i + 1; END;
 -?>p{2cm}<?lsmb FOREACH c IN report.cheads.ids.keys; 'r'; END ?>}
\\
\multicolumn{<?lsmb max_path_depth+1 ?>}{l}{}%
<?lsmb
 FOREACH col IN report.cheads.ids.keys;
     ' & ';
     report.cheads.ids.$col.props.description ;
 END;
 ?> \\
\\
<?lsmb FOREACH row IN report.sorted_row_ids ;
   path_depth = report.rheads.ids.$row.path.size;
   path_prefix_len = path_depth - 1;
   path_suffix_len = max_path_depth - path_prefix_len;

   IF report.incl_accnos && report.rheads.ids.$row.props.account_number;
     desc = report.rheads.ids.$row.props.account_number _ ' - ' _ report.rheads.ids.$row.props.account_description;
   ELSE;
     desc = report.rheads.ids.$row.props.account_description;
   END;

  IF report.rheads.ids.$row.props.account_type == 'H';
    '\cline{' _ path_depth _ '-' _ last_col_no _ '} ';
    desc = '\emph{' _ desc _ '}';
  END ;
-?>%
%
<?lsmb
  j = 1;
  WHILE j < path_prefix_len ;
    '& ';
    j = j + 1;
  END;
-?>
<?lsmb IF path_prefix_len > 0 -?>
 &
<?lsmb END -?>
<?lsmb IF path_suffix_len > 1 -?>
\multicolumn{<?lsmb path_suffix_len ?>}{l}{<?lsmb desc ?>}%
<?lsmb ELSE -?>
<?lsmb desc ?>
<?lsmb END -?>
%
& %
<?lsmb FOREACH col IN report.cheads.ids.keys;
  ' & '; report.cells.$row.$col;
END; -?>
%
\\
%
<?lsmb IF report.rheads.ids.$row.props.account_type == 'H'; ?>
\\
<?lsmb END -?>
<?lsmb END -?>

\end{longtable}
\end{document}

%<?lsmb END ?>
