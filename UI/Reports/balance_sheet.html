<?lsmb INCLUDE 'ui-header.html' stylesheet=request.stylesheet
         include_stylesheet = ['UI/Reports/pnl.css'];

FORMATS = LIST_FORMATS();
LINK = request.script _ '?' _ ENVARS.QUERY_STRING _ '&amp;company=' _ DBNAME;
LINK = LINK.replace('\&amp;\&amp;', '&amp;');
DRILLBASE = 'journal.pl?sort=transdate&amp;&amp;category=X'
       _ '&amp;col_transdate=Y&amp;col_reference=Y&amp;col_description=Y'
       _ '&amp;col_debits=Y&amp;col_credits=Y&amp;col_source=Y'
       _ '&amp;col_accno=Y&amp;action=search&amp;col_running_balance=Y';

USE String;
 ?>
<body class="financial-statement <?lsmb dojo_theme ?>">
<div id="PNL"> <!-- TODO: Find better name!! -->
<h1><?lsmb text('Balance Sheet') ?></h1>

<table>
<tr class="report-head">
  <th><?lsmb text('Accounts') ?></th>
<?lsmb FOREACH col IN report.cheads.ids.keys -?>
  <th><?lsmb report.cheads.ids.$col.props.description ?></th>
<?lsmb END -?>
</tr>
<?lsmb FOREACH row IN report.sorted_row_ids ?>
<tr>
  <th><?lsmb nbsp = String.new("&nbsp;"); nbsp.repeat(report.rheads.ids.$row.path.size); -?>
<?lsmb IF report.rheads.ids.$row.props.account_number && report.incl_accnos; -?>
<?lsmb report.rheads.ids.$row.props.account_number ?> - <?lsmb END; -?>
<?lsmb report.rheads.ids.$row.props.account_desc ?></th>
<?lsmb FOREACH col IN report.cheads.ids.keys -?>
  <!-- ###TODO-REPORT-HEADINGS: add links on the cells to 'drill downs' -->
  <td class="amount"><a href="<?lsmb
 DRILLBASE _ '&amp;accno=' _ report.rheads.ids.$row.props.account_number
           _ '&amp;to_date=' _ report.cheads.ids.$col.props.to_date ?>"><?lsmb report.cells.$row.$col ?></a></td><?lsmb END ?>
</tr>
<?lsmb END ?>

<!--
<h2><?lsmb text('Key Ratios'); ?></h2>
<h2><?lsmb text('First column only') ?></h2>
<table>
<tr><th><?lsmb text('Assets to Liabilities') ?></th>
    <td><?lsmb report.balance_sheet.ratios.AL ?></td>
</tr>
<tr><th><?lsmb text('Assets to Equity') ?></th>
    <td><?lsmb report.balance_sheet.ratios.AQ ?></td>
</tr>
<tr><th><?lsmb text('Equity to Liabilities') ?></th>
    <td><?lsmb report.balance_sheet.ratios.QL ?></td>
</tr>
-->

<?lsmb IF FORMATS.grep('PDF').size() ?>
<tr><td><a target="_blank"
           href="<?lsmb LINK ?>&amp;format=PDF">[<?lsmb text('PDF') ?>]</a></td>
<td><a target="_blank"
       href="<?lsmb LINK ?>&amp;format=CSV">[<?lsmb text('CSV') ?>]</a></td>
</tr>
<?lsmb END ?>
</table>
</div>
</body>
</html>
